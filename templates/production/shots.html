{% extends 'main/base.html' %}

{% block bread_crumb %}
    <link rel='stylesheet' href='/static/third_party/DataTables/DataTables-1.12.1/css/jquery.dataTables.min.css'
          type="text/css"/>
    <link rel='stylesheet' href='/static/third_party/DataTables/Responsive-2.3.0/css/responsive.dataTables.min.css'
          type="text/css"/>
    <link rel='stylesheet' href='/static/third_party/DataTables/Responsive-2.3.0/css/responsive.bootstrap5.min.css'
          type="text/css"/>
    <link rel='stylesheet' href='/static/third_party/DataTables/Buttons-2.2.3/css/buttons.dataTables.min.css'
          type="text/css"/>
    <link rel='stylesheet' href='/static/template/assets/plugins/multiselect/css/multi-select.css'
          type="text/css"/>
    <link rel="stylesheet"
          href="/static/template/assets/plugins/toast-master/css/jquery.toast.css" type="text/css"/>
    <link rel="stylesheet"
          href="/static/third_party/DataTables/custom_css/datables_searchpane.css" type="text/css"/>
    <link rel="stylesheet"
          href="/static/third_party/DataTables/Select-1.4.0/css/select.dataTables.min.css" type="text/css"/>
    <link href="/static/third_party/DataTables/DataTables-1.12.1/css/dataTables.jqueryui.css" rel="stylesheet"
          type="text/css"/>
    <link href="/static/third_party/DataTables/DateTime-1.1.2/css/dataTables.dateTime.min.css" rel="stylesheet"
          type="text/css"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/themes/south-street/jquery-ui.min.css"
          rel="stylesheet" type="text/css"/>
    <link href="https://cdn.datatables.net/plug-ins/725b2a2115b/integration/jqueryui/dataTables.jqueryui.css"
          rel="stylesheet" type="text/css"/>
    <style>
        .form-control {
            color: #fffcfc !important;
        }

        .container-fluid {
            padding: 10px !important;
        }

        .row {
            margin: 0px !important;
        }

        /* An ugly trick to use a filter icon */
        .ui-icon-volume-off.ui-icon-filter {
            -ms-transform: rotate(270deg);
            -webkit-transform: rotate(270deg);
            transform: rotate(270deg);
        }

        .card {
            padding: 10px;
            background: #272c33 !important;
            color: white;
            margin-bottom: 10px !important;
        }

        #filter_div {
            padding: 10px;
            background: #272c33 !important;
            color: white;
        }

        .col-lg-12 {
            padding: 0px !important;
        }

        .col-lg-10 {
            padding: 0px !important;
        }

        .card-body {
            padding: 0rem !important;
        }

        .dt-buttons .dt-button {
            border-radius: 4px;
            background: orange;
            color: #ffffff
        }

        table.dataTable tbody tr {
            background-color: #272c33 !important;
            font-size: small;
            font-weight: normal;
        }

        table.dataTable tr.odd {
            background-color: #343a40 !important;
        }

        table.dataTable td {
            border-bottom: 0.2px !important;
            border-color: grey !important;
        }

        table.dataTable thead {
            color: #f6f5f5;
            font-weight: normal;
            font-size: small;
        }

        #shots_table_length, #shots_table_info, #shots_table_filter {
            color: #a2a1a1 !important;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button {
            padding: 2px;
            background: white !important;
        }
        .dataTables_wrapper .dataTables_paginate .paginate_button.current {
            color: #fff5f5 !important;
            background-color: rgb(230 137 6) !important;
        }
        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
            background-color: rgb(183, 110, 5) !important;
        }
        tfoot input {
            width: 100% !important;
            padding: 3px !important;
            box-sizing: border-box !important;
        }

        table.dataTable tfoot th, table.dataTable tfoot td {
            padding: 5px;
            border-top: 0px;
        }

        .page-titles {
            padding-bottom: 0px;
        }

        .dataTables_wrapper .dataTables_length select {
            color: #ccc8c8 !important;
            background-color: inherit;
        }

        .dataTables_wrapper .dataTables_filter input {
            color: #dad8d8 !important;
        }

        table.dataTable tbody tr.selected {
            background-color: #315eb1 !important;
            color: white !important;
        }

        label {
            margin-bottom: 0px !important;
        }

        .multiselect-container > li > a > label {
            padding: 4px 20px 3px 20px;
        }

        table.dataTable tbody th, table.dataTable tbody td {
            padding: 7px;
        }

        .column_vis {
            height: 20px;
        }

        /* width */
        ::-webkit-scrollbar {
            width: 10px;
        }

        /* Track */
        ::-webkit-scrollbar-track {
            background: #383f48;
            border-radius: 5px;
        }

        /* Handle */
        ::-webkit-scrollbar-thumb {
            background: #2965b9;
            border-radius: 5px;
        }

        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }


        div.dtsp-verticalContainer {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: flex-start;
            align-content: flex-start;
            align-items: flex-start;
        }

        div.dtsp-verticalContainer div.dtsp-verticalPanes,
        div.dtsp-verticalContainer div.container {
            width: 20%;
            flex-grow: 0;
            flex-shrink: 0;
            flex-basis: 0;
        }

        div.dtsp-verticalContainer div.dtsp-verticalPanes {
            flex-grow: 1;
            flex-shrink: 0;
            flex-basis: 26%;
        }

        div.dtsp-verticalPanes {
            margin-right: 10px;
        }

        div.dtsp-title {
            margin-right: 0px !important;
            margin-top: 13px !important;
        }

        input.dtsp-search {
            min-width: 0px !important;
            padding-left: 0px !important;
            margin: 0px !important;
        }

        div.dtsp-verticalContainer div.dtsp-verticalPanes div.dtsp-searchPanes {
            flex-direction: column;
            flex-basis: 0px;
        }

        div.dtsp-verticalContainer div.dtsp-verticalPanes div.dtsp-searchPanes div.dtsp-searchPane {
            flex-basis: 0px;
        }

        div.dtsp-verticalContainer div.container {
            flex-grow: 1;
            flex-shrink: 0;
            flex-basis: 80%;
        }

        div.dtsp-panesContainer {
            border: 1px solid transparent;
            border-radius: 6px;
            padding: 5px;
        }

        select {
            -webkit-appearance: none;
        }

        div.dtsp-narrow {
            flex-direction: column !important;
            background-color: #343a40;
        }

        div.dtsp-panesContainer button.dtsp-clearAll, div.dtsp-panesContainer button.dtsp-collapseAll, div.dtsp-panesContainer button.dtsp-showAll {
            border: none;
            background-color: #343a40;
            padding: 3px;
            border-radius: 5px;
        }

        div.dtsp-panesContainer button.dtsp-disabledButton {
            cursor: default !important;
            background-color: #343a40;
            padding: 3px;
            border-radius: 10px;
            color: white;
        }

        div.dtsp-panesContainer div.dataTables_wrapper div.dataTables_scrollBody {
            background: #343a40 !important;
            border-bottom: none;
        }

        /* An ugly trick to use a filter icon */
        .ui-icon-volume-off.ui-icon-filter {
            -ms-transform: rotate(270deg);
            -webkit-transform: rotate(270deg);
            transform: rotate(270deg);
        }

        .modal.right .modal-dialog {
            position: fixed;
            margin: auto;
            width: 700px;
            height: 100%;
            -webkit-transform: translate3d(0%, 0, 0);
            -ms-transform: translate3d(0%, 0, 0);
            -o-transform: translate3d(0%, 0, 0);
            transform: translate3d(0%, 0, 0);
        }

        .modal.right .modal-content {
            height: 100%;
            overflow-y: auto;
        }

        .modal.right .modal-body {
            padding: 15px 15px 80px;
        }

        .modal.right.fade .modal-dialog {
            right: 0px;
            -webkit-transition: opacity 0.3s linear, right 0.3s ease-out;
            -moz-transition: opacity 0.3s linear, right 0.3s ease-out;
            -o-transition: opacity 0.3s linear, right 0.3s ease-out;
            transition: opacity 0.3s linear, right 0.3s ease-out;
        }

        .modal.right.fade.in .modal-dialog {
            right: 0;
        }

        /* ----- MODAL STYLE ----- */
        .modal-content {
            border-radius: 0;
            border: none;
        }

        .modal-header {
            border-bottom-color: #EEEEEE;
            background-color: #756e6e;
        }


    </style>
    <div class="row page-titles">
        <div class="col-md-6 col-4 float-left">
            <h3 class="text-themecolor mb-0 mt-2">SHOTS</h3>
        </div>
        <div class="col-md-6 col-8 float-right" style="background-color: #e5711d;border-radius: 10px">
            <div class="float-right" style="margin-left: 5px">
                <button class="btn waves-effect waves-lightfloat-right" title="Export to Excel"
                        onclick="export_to_excel()"><i
                        class="mdi mdi-cloud-download" style="color: white;font-size: large"></i> EXPORT TO EXCEL
                </button>
            </div>
{#            TODO: Enable to work on filters#}
            <!--- Filter button --->
            <div class="float-right" style="margin-left: 5px">

                <button class="column_filter btn waves-effect waves-lightfloat-right" title="Filters"
                        data-toggle="button" aria-pressed="true">
                    <i
                            class="mdi mdi-filter" style="color:white;font-size: large"></i> FILTERS
                </button>
            </div>
            <div class="float-right" style="margin-left: 5px">
                <button type="button" class="assign_leads btn waves-effect waves-light float-right"
                        title="Assign to Team Leads"><i
                        class="mdi mdi-account-plus" style="color:white;font-size: large"></i> ASSIGN TO LEADS
                </button>
            </div>
        </div>
    </div>
    <!-- ============================================================== -->
    <!-- End Bread crumb and right sidebar toggle -->
    <!-- ============================================================== -->
{% endblock bread_crumb %}


{% block content %}
    <div class="container-fluid row">

        <!-- Shots Table View -->
        <div class="col-lg-12" id="shots_list_view">
            <div class="card">

                <table id="shots_table" class="table display no-wrap" style="width:100%">


                </table>

            </div>
        </div>
        <div class="col-md-3 col-2 card" id="filter_div"
             style="display: none;height:1000px;overflow-y: auto;margin: 0px;">
            <h6><i onclick="header_vis(this)" class="ti-angle-right"></i> Header Visibility</h6>
            <div class="card" id="header_filter"
                 style="display: none; height:200px; overflow-y: scroll; border-bottom: 1px solid #494848;border-radius: 0px">
                <div class="card-body">
                    <input type="text" class="form-control column_vis" id="search_header" onkeyup="search_column()"
                           placeholder="Search for...">
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="client" data-column="1"
                               value="check" checked>
                        <label class="custom-control-label" for="client">CLIENT</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="project" data-column="2"
                               value="check" checked>
                        <label class="custom-control-label" for="project">PROJECT</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="seq" data-column="3"
                               value="check" checked>
                        <label class="custom-control-label" for="seq">SEQUENCE</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="shot" data-column="4"
                               value="check" checked>
                        <label class="custom-control-label" for="shot">SHOT</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="task_type" data-column="5"
                               value="check" checked>
                        <label class="custom-control-label" for="task_type">TASK TYPE</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="type" data-column="6"
                               value="check" checked>
                        <label class="custom-control-label" for="type">TYPE</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="complexity" data-column="7"
                               value="check" checked>
                        <label class="custom-control-label" for="complexity">COMPLEXITY</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="status" data-column="8"
                               value="check" checked>
                        <label class="custom-control-label" for="status">STATUS</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="progress" data-column="9"
                               value="check" checked>
                        <label class="custom-control-label" for="progress">PROGRESS</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="actual_bids" data-column="10"
                               value="check" checked>
                        <label class="custom-control-label" for="actual_bids">ACTUAL BIDS</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="consumed_bids"
                               data-column="11"
                               value="check" checked>
                        <label class="custom-control-label" for="consumed_bids">CONSUMED BIDS</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="eta" data-column="12"
                               value="check" checked>
                        <label class="custom-control-label" for="eta">ETA</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="frame_in" data-column="13"
                               value="check" checked>
                        <label class="custom-control-label" for="frame_in">FRAME IN</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="frame_out" data-column="14"
                               value="check" checked>
                        <label class="custom-control-label" for="frame_out">FRAME OUT</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="duration" data-column="15"
                               value="check" checked>
                        <label class="custom-control-label" for="duration">DURATION</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="team_lead" data-column="16"
                               value="check" checked>
                        <label class="custom-control-label" for="team_lead">TEAM LEAD</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="artist" data-column="17"
                               value="check" checked>
                        <label class="custom-control-label" for="artist">ARTIST</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="version" data-column="18"
                               value="check" checked>
                        <label class="custom-control-label" for="version">VERSION</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="location" data-column="19"
                               value="check" checked>
                        <label class="custom-control-label" for="location">LOCATION</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="locality" data-column="20"
                               value="check" checked>
                        <label class="custom-control-label" for="locality">LOCALITY</label>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="form-group row">
                        <label for="min" class="col-4 col-form-label">ETA FROM</label>
                        <div class="col-8">
                            <input class="form-control" type="text" id="min" name="min">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="max" class="col-4 col-form-label">ETA TO</label>
                        <div class="col-8">
                            <input class="form-control" type="text" id="max" name="max">
                        </div>
                    </div>
                    <div class="dtsp-verticalContainer">
                        <div class="dtsp-verticalPanes">
                        </div>
                        <div class="container">
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <div id="select_lead_modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Select Team Lead</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal" role="form">
                        {% csrf_token %}
                        <div class="form-body" id="select_lead">
                            <select id="shot_lead_select" class="form-control">
                                <option value="0">Select Team Lead</option>
                                {% for lead in leads %}
                                    <option value={{ lead.id }}>{{ lead.fullName }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" name="save" class="btn btn-success waves-effect waves-light"
                            onclick="assign_lead()">Assign
                    </button>
                    <button type="button" name="close" class="btn btn-default waves-effect" data-dismiss="modal"
                            onclick="close_assign_modal()">Close
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal right fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2">
        <div class="modal-dialog" role="document">
            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel2">Right Sidebar</h4>
                </div>

                <div class="modal-body">

                    <p>Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. 3
                        wolf moon officia aute, non cupidatat skateboard dolor brunch. Food truck quinoa nesciunt
                        laborum eiusmod. Brunch 3 wolf moon tempor, sunt aliqua put a bird on it squid single-origin
                        coffee nulla assumenda shoreditch et. Nihil anim keffiyeh helvetica, craft beer labore wes
                        anderson cred nesciunt sapiente ea proident. Ad vegan excepteur butcher vice lomo. Leggings
                        occaecat craft beer farm-to-table, raw denim aesthetic synth nesciunt you probably haven't heard
                        of them accusamus labore sustainable VHS.
                    </p>
                </div>

            </div><!-- modal-content -->
        </div><!-- modal-dialog -->
    </div><!-- modal -->
    <div class="custom_preloader spinner-grow text-warning" role="status">
        <span class="sr-only">Loading...</span>
    </div>

{% endblock content %}



{% block page_scripts %}
    <!--OFX Core JavaScript -->
    <script src="/static/ofx/core.js"></script>
    <script src="/static/template/assets/plugins/popper/popper.min.js"></script>
    <script src="/static/template/assets/plugins/toast-master/js/jquery.toast.js"></script>
    <script src="/static/third_party/DataTables/DataTables-1.12.1/js/jquery.dataTables.min.js"></script>
    <script src="/static/third_party/DataTables/Responsive-2.3.0/js/dataTables.responsive.min.js"></script>
    <script src="/static/third_party/DataTables/Responsive-2.3.0/js/responsive.bootstrap5.min.js"></script>
    <script src="/static/third_party/DataTables/Buttons-2.2.3/js/dataTables.buttons.min.js"></script>
    <script src="/static/third_party/DataTables/Buttons-2.2.3/js/buttons.html5.min.js"></script>
    <script src="/static/third_party/DataTables/Bootstrap-5-5.1.3/js/bootstrap.bundle.min.js"></script>
    <script src="/static/third_party/DataTables/custom_js/datatables_searchPane.js"></script>
    <script src="/static/third_party/DataTables/Select-1.4.0/js/dataTables.select.min.js"></script>
    <script src="/static/template/assets/plugins/moment/moment.js"></script>
    <script src="/static/third_party/DataTables/DateTime-1.1.2/js/dataTables.dateTime.min.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/jquery.ui-contextmenu/1.7.0/jquery.ui-contextmenu.min.js"></script>
    <script src="https://cdn.datatables.net/colreorder/1.1.2/js/dataTables.colReorder.min.js"></script>
    <script src="https://cdn.datatables.net/plug-ins/725b2a2115b/api/fnFilterClear.js"></script>
    <script>
        // Custom filtering function which will search data in column tweleve between two values
        $.fn.dataTable.ext.search.push(
            function (settings, data, dataIndex) {
                var min = minDate.val();
                var max = maxDate.val();
                var date = new Date(data[12]);

                if (
                    (min === null && max === null) ||
                    (min === null && date <= max) ||
                    (min <= date && max === null) ||
                    (min <= date && date <= max)
                ) {
                    return true;
                }
                return false;
            }
        );

        $(".column_filter").click(function (e) {
            var x = document.getElementById("filter_div");
            if (x.style.display === "none") {
                $('.col-lg-12').addClass('col-lg-9').removeClass('col-lg-12')
                x.style.display = "block";
            } else {
                x.style.display = "none";
                $('.col-lg-9').addClass('col-lg-12').removeClass('col-lg-9')
            }
        });

        $(window).click(function (e) {
            $("#filters-modal").modal('hide');
        });

        function header_vis(x) {
            x.classList.toggle("ti-angle-down");
            var s = document.getElementById("header_filter");
            if (s.style.display === "none") {
                s.style.display = "block";
            } else {
                s.style.display = "none";
            }
        }

        function search_column() {
            var input = document.getElementById("search_header");
            var filter = input.value.toLowerCase();
            var nodes = document.getElementsByClassName('custom-checkbox');

            for (i = 0; i < nodes.length; i++) {
                if (nodes[i].innerText.toLowerCase().includes(filter)) {
                    nodes[i].style.display = "block";
                } else {
                    nodes[i].style.display = "none";
                }
            }
        }

        let client_id = 0;
        let project_id = 0;
        let status_id = 0
        let location_id = 0
        let locality_id = 0
        let task_type_id = 0

        //  Load Shots Information
        status_list = "YTA|ATL|YTS|STQ|WIP|IRT|QIP|CRT|IAP|LAP|LRT|HLD|OMT"

        var shotId_arr = [];
        var table = ""

        $(document).ready(function () {
            // Create date inputs
            minDate = new DateTime($('#min'), {
                format: 'MMMM Do YYYY'
            });
            maxDate = new DateTime($('#max'), {
                format: 'MMMM Do YYYY'
            });

            $(".custom_preloader").hide()

            table = $('#shots_table').DataTable({
                columnDefs: [
                    {
                        searchPanes: {
                            show: false
                        },
                        targets: [3, 4, 9, 10, 11, 12, 13, 14, 15, 18]
                    },
                    {className: "shot_class", "targets": [4]}
                ],
                searchPanes: {
                    cascadePanes: true,
                    layout: 'columns-1',
                    controls: false,

                },
                dom: '<"dtsp-dataTable"frtip>',
                "searching": true,
                "ajax": {
                    "processing": true,
                    "url": "/api/production/production_sheet/?status=" + status_list + "/",
                    "type": "GET",
                    "dataSrc": ""
                },
                'language': {
                    'loadingRecords': '&nbsp;',
                    'processing': 'Loading...'
                },

                columns: [
                    {
                        data: "id",
                        render: function (data, type, row, meta) {
                            return (
                                '<input type="checkbox" name="shotCheckbox" class="shot_checkbox"  value="' +
                                data +
                                '">'
                            );
                        },
                    },
                    {name: "client", title: "CLIENT", data: 'sequence.project.client.name'},
                    {name: "project", title: "PROJECT", data: 'sequence.project.name'},
                    {name: "seq", title: "SEQUENCE", data: 'sequence.name'},
                    {name: "shot", title: "SHOT CODE", data: 'name'},
                    {name: "task_type", title: "TASK TYPE", data: 'task_type'},
                    {name: "type", title: "TYPE", data: 'type'},
                    {name: "complexity", title: "COMPLEXITY", data: 'complexity'},
                    {
                        name: "status",
                        title: "STATUS", data: 'status',
                        render: function (data, type, row, meta) {
                            return (
                                '<span class="badge" style="color:white;padding:3px 10px;font-size:1em; background-color:' + data.color + '">' + data.code + '</span>'
                            );
                        },
                    },
                    {
                        name: "progress",
                        title: "PROGRESS", data: 'progress',
                        render: function (data, type, row, meta) {
                            return (
                                `<div class="progress" style="height: 15px;">
                        <div class="progress-bar" style="width:` + data + `%;background-color:red;color: white;font-weight: bold" role="progressbar">` + data + `%</div>
                    </div>`
                            )
                        }
                    },
                    {name: "actual_bids", title: "ACTUAL BIDS", data: 'bid_days'},
                    {
                        name: "consumed_bids",
                        title: "CONSUMED BIDS", data: 'total_spent',
                        render: function (data, type, row, meta) {
                            return data.toFixed(2)
                        }
                    },
                    {
                        name: "eta",
                        title: "ETA", data: 'eta',
                        render: function (data, type, row, meta) {
                            return moment(data).format("YYYY-MM-DD");
                        }
                    },
                    {name: "frame_in", title: "START FRAME", data: 'actual_start_frame'},
                    {name: "frame_out", title: "END FRAME", data: 'actual_end_frame'},
                    {name: "duration", title: "DURATION", data: null, "defaultContent": ""},
                    {name: "team_lead", title: "TEAM LEAD", data: 'team_lead'},
                    {name: "artist", title: "ARTIST", data: 'artist'},
                    {name: "version", title: "VERSION", data: 'version'},
                    {name: "location", title: "LOCATION", data: 'location'},
                    {name: "locality", title: "LOCALITY", data: 'sequence.project.client.locality'},
                ],
                select: true,
                order: [[1, 'asc']],
                scrollResize: true,
                scrollX: true,
                scrollCollapse: true,
                buttons: [],
                "paging": true,
                "pageLength": 25,
                "bSortClasses": false,
                stateSave: true,
                deferLoading: 10,

            });
            table.searchPanes()

            // Refilter the table to apply ETA Filters
            $('#min, #max').on('change', function () {
                table.draw();
            });

            // Below code saves boolean type  in localstorage for header visibility
            var all_columns = table.settings().init().columns;
            var visible_columns = [];
            for (var i in all_columns) {
                if (table.column(all_columns[i].name + ':name').visible()) {
                    localStorage.setItem(all_columns[i].name, true)
                    $('#' + all_columns[i].name).prop('checked', true)
                    visible_columns.push(all_columns[i].name);
                } else {
                    localStorage.setItem(all_columns[i].name, false)
                    $('#' + all_columns[i].name).prop('checked', false)
                }
            }

            // Toggles header visibility
            $('input.toggle-vis').on('click', function (e) {
                {#e.preventDefault();#}

                // Get the column API object
                var column = table.column($(this).attr('data-column'));

                // Toggle the visibility
                column.visible(!column.visible());
            });
            $("div.dtsp-verticalPanes").append(table.searchPanes.container());
        });

        //TeamLead Assignments Modal Show
        $(".assign_leads").click(function (e) {
            shotId_arr.length = 0
            $("input:checkbox[class=shot_checkbox]:checked").each(function () {
                shotId_arr.push($(this).val());
            });

            if (shotId_arr.length > 0) {
                $('#select_lead_modal').modal('show');
            } else {
                alert("No Shots are Selected")
            }
        });

        // TeamLead Assignments Post Data Function
        function assign_lead() {
            $(".custom_preloader").show()
            var post_count = 0;
            for (i = 0; i < shotId_arr.length; i++) {
                shotData = {
                    'shot': shotId_arr[i],
                    'lead': $('#shot_lead_select option:selected').val(),
                    'status': 11,
                    'assigned_by': {{ user.profile.employee.id }}
                }
                $.post("/api/production/shot/assignments/", shotData,
                    function (data, status) {
                        shot_status = {
                            'status': "ATL"
                        }
                        $.ajax({
                            url: "/api/production/shots/" + data['shot'] + "/",
                            type: 'PUT',
                            data: shot_status,
                            dataType: 'json',
                            success: function (result) {
                                ++post_count;
                                if (post_count == shotId_arr.length) {
                                    table.ajax.reload(null, false)
                                    $(".custom_preloader").hide()
                                    $.toast({
                                        heading: 'Success',
                                        text: 'Assigned to' + $('#shot_lead_select option:selected').text() + '.',
                                        position: 'top-right',
                                        loaderBg: '#49ffbf',
                                        icon: 'success',
                                        hideAfter: 3000,
                                        stack: 6
                                    });
                                }
                            }
                        });
                    }
                )
            }
            $('#select_lead_modal').modal('hide');
        }

        // TeamLead Assignments Modal Close
        function close_assign_modal() {
            $('#select_lead_modal').modal('hide');
        }

        // TODO: Enable to view the shots data in modal
        // Table On Row Click
        {#$('#shots_table').on('click', 'td.shot_class', function () {#}
        {#    $("#myModal2").modal('show');#}
        {#})#}

        // Export Production sheet to Excel
        function export_to_excel() {
            window.location = "/production/export_prod_report/?client=" + client_id + "&project=" + project_id + "&statuss=" + status_id + "&locality=" + locality_id + "&location=" + location_id + "&task_type=" + task_type_id
        }
    </script>
{% endblock page_scripts %}