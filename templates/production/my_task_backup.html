{% extends 'main/base.html' %}

{% block bread_crumb %}

    <link rel='stylesheet' href='/static/third_party/DataTables/DataTables-1.12.1/css/jquery.dataTables.min.css'
          type="text/css"/>
    <link rel='stylesheet' href='/static/third_party/DataTables/Responsive-2.3.0/css/responsive.dataTables.min.css'
          type="text/css"/>
    <link rel='stylesheet' href='/static/third_party/DataTables/Responsive-2.3.0/css/responsive.bootstrap5.min.css'
          type="text/css"/>
    <link rel='stylesheet' href='/static/third_party/DataTables/Buttons-2.2.3/css/buttons.dataTables.min.css'
          type="text/css"/>
    <link rel='stylesheet' href='/static/template/assets/plugins/multiselect/css/multi-select.css'
          type="text/css"/>
    <link rel="stylesheet"
          href="/static/third_party/DataTables/custom_css/datables_searchpane.css" type="text/css"/>
    <link rel="stylesheet"
          href="/static/third_party/DataTables/Select-1.4.0/css/select.dataTables.min.css" type="text/css"/>
    <link href="/static/third_party/DataTables/DataTables-1.12.1/css/dataTables.jqueryui.css" rel="stylesheet"
          type="text/css"/>
    <link href="/static/third_party/DataTables/DateTime-1.1.2/css/dataTables.dateTime.min.css" rel="stylesheet"
          type="text/css"/>
    <link href="/static/main/jquery-ui-themes-1.11.1/themes/south-street/jquery-ui.min.css" rel="stylesheet" type="text/css"/>
    <link href="/static/main/dataTables.jqueryui.css" rel="stylesheet" type="text/css"/>
    <link rel='stylesheet' href='/static/assets/css/style.css' type="text/css"/>
    <style>
        .form-control {
            color: #fffcfc !important;
        }

        .container-fluid {
            padding: 10px !important;
        }

        .row {
            margin: 0px !important;
        }

        /* An ugly trick to use a filter icon */
        .ui-icon-volume-off.ui-icon-filter {
            -ms-transform: rotate(270deg);
            -webkit-transform: rotate(270deg);
            transform: rotate(270deg);
        }

        .card {
            padding: 10px 1px;
            background: #272c33 !important;
            color: white;
            margin-bottom: 10px !important;
        }

        #filter_div {
            padding: 10px;
            background: #272c33 !important;
            color: white;
        }

        .col-lg-12 {
            padding: 0px !important;
        }

        .col-lg-10 {
            padding: 0px !important;
        }

        .card-body {
            padding: 0rem !important;
        }

        .dt-buttons .dt-button {
            border-radius: 4px;
            background: orange;
            color: #ffffff
        }

        table.dataTable tbody tr {
            background-color: #272c33 !important;
            font-size: small;
            font-weight: normal;
        }

        table.dataTable tr.odd {
            background-color: #343a40 !important;
        }

        table.dataTable td {
            border-bottom: 0.2px !important;
            border-color: grey !important;
        }

        table.dataTable thead {
            color: #f6f5f5;
            font-weight: normal;
            font-size: small;
        }

        #shots_table_length, #shots_table_info, #shots_table_filter {
            color: #a2a1a1 !important;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button {
            padding: 2px;
            background: white !important;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button.current {
            color: #fff5f5 !important;
            background-color: #e5711d !important;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
            background-color: rgb(183, 110, 5) !important;
        }

        .dataTables_wrapper .dataTables_paginate .ellipsis {
            color: white;
        }

        tfoot input {
            width: 100% !important;
            padding: 3px !important;
            box-sizing: border-box !important;
        }

        table.dataTable tfoot th, table.dataTable tfoot td {
            padding: 5px;
            border-top: 0px;
        }

        .page-titles {
            padding-bottom: 0px;
        }

        .dataTables_wrapper .dataTables_length select {
            color: #ccc8c8 !important;
            background-color: inherit;
        }

        .dataTables_wrapper .dataTables_filter input {
            color: #dad8d8 !important;
        }


        table.dataTable tbody tr.selected {
            background-color: #315eb1 !important;
            color: white !important;
        }

        label {
            margin-bottom: 0px !important;
        }

        .multiselect-container > li > a > label {
            padding: 4px 20px 3px 20px;
        }

        table.dataTable tbody th, table.dataTable tbody td {
            padding: 7px;
        }

        .column_vis {
            height: 20px;
        }

        /* width */
        ::-webkit-scrollbar {
            width: 10px;
        }

        /* Track */
        ::-webkit-scrollbar-track {
            background: #383f48;
            border-radius: 5px;
        }

        /* Handle */
        ::-webkit-scrollbar-thumb {
            background: #2965b9;
            border-radius: 5px;
        }

        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }


        div.dtsp-verticalContainer {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: flex-start;
            align-content: flex-start;
            align-items: flex-start;
        }

        div.dtsp-verticalContainer div.dtsp-verticalPanes,
        div.dtsp-verticalContainer div.container {
            width: 20%;
            flex-grow: 0;
            flex-shrink: 0;
            flex-basis: 0;
        }

        div.dtsp-verticalContainer div.dtsp-verticalPanes {
            flex-grow: 1;
            flex-shrink: 0;
            flex-basis: 26%;
        }

        div.dtsp-verticalPanes {
            margin-right: 10px;
        }

        div.dtsp-title {
            margin-right: 0px !important;
            margin-top: 13px !important;
        }

        input.dtsp-search {
            min-width: 0px !important;
            padding-left: 0px !important;
            margin: 0px !important;
        }

        div.dtsp-verticalContainer div.dtsp-verticalPanes div.dtsp-searchPanes {
            flex-direction: column;
            flex-basis: 0px;
        }

        div.dtsp-verticalContainer div.dtsp-verticalPanes div.dtsp-searchPanes div.dtsp-searchPane {
            flex-basis: 0px;
        }

        div.dtsp-verticalContainer div.container {
            flex-grow: 1;
            flex-shrink: 0;
            flex-basis: 80%;
        }

        div.dtsp-panesContainer {
            border: 1px solid transparent;
            border-radius: 6px;
            padding: 5px;
        }

        select {
            -webkit-appearance: none;
        }

        div.dtsp-narrow {
            flex-direction: column !important;
            background-color: #343a40;
        }

        div.dtsp-panesContainer button.dtsp-clearAll, div.dtsp-panesContainer button.dtsp-collapseAll, div.dtsp-panesContainer button.dtsp-showAll {
            border: none;
            background-color: #343a40;
            padding: 3px;
            border-radius: 5px;
        }

        div.dtsp-panesContainer button.dtsp-disabledButton {
            cursor: default !important;
            background-color: #343a40;
            padding: 3px;
            border-radius: 10px;
            color: white;
        }

        div.dtsp-panesContainer div.dataTables_wrapper div.dataTables_scrollBody {
            background: #343a40 !important;
            border-bottom: none;
        }

        /* An ugly trick to use a filter icon */
        .ui-icon-volume-off.ui-icon-filter {
            -ms-transform: rotate(270deg);
            -webkit-transform: rotate(270deg);
            transform: rotate(270deg);
        }

        .modal.right .modal-dialog {
            position: fixed;
            margin: auto;
            width: 700px;
            height: 100%;
            -webkit-transform: translate3d(0%, 0, 0);
            -ms-transform: translate3d(0%, 0, 0);
            -o-transform: translate3d(0%, 0, 0);
            transform: translate3d(0%, 0, 0);
        }

        .modal.right .modal-content {
            height: 100%;
            overflow-y: auto;
        }

        .modal.right .modal-body {
            padding: 15px 15px 15px;
        }

        .modal.right.fade .modal-dialog {
            right: 0px;
            -webkit-transition: opacity 0.3s linear, right 0.3s ease-out;
            -moz-transition: opacity 0.3s linear, right 0.3s ease-out;
            -o-transition: opacity 0.3s linear, right 0.3s ease-out;
            transition: opacity 0.3s linear, right 0.3s ease-out;
        }

        .modal.right.fade.in .modal-dialog {
            right: 0;
        }

        /* ----- MODAL STYLE ----- */
        .modal-content {
            border-radius: 0;
            border: none;
        }

        .modal-header {
            border-bottom-color: #EEEEEE;
            background-color: #e5711d;
        }

        input.dtsp-search::placeholder {
            color: #a4a4a8 !important;
        }
    </style>
    <div class="row page-titles">
        <div class="col-md-6 col-4 float-left">
            <h3 class="text-themecolor mb-0 mt-2">My Task</h3>
        </div>
        <div class="col-md-6 col-8">
            <div class="float-right" style="background-color: #e5711d;border-radius: 10px">
                <div class="float-right" style="margin-left: 5px">
                    <button class="btn waves-effect waves-light float-right" title="Export to Excel" onclick="export_to_excel()"><i class="mdi mdi-cloud-download" style="color: white;font-size: large"></i> MY REPORT
                    </button>
                </div>
                <!--- Filter button --->
                <div class="float-right" style="margin-left: 5px">

                    <button class="column_filter btn waves-effect waves-light float-right" title="Filters" data-toggle="button" aria-pressed="true">
                        <i class="mdi mdi-filter" style="color:white;font-size: large"></i> FILTERS
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================================== -->
    <!-- End Bread crumb and right sidebar toggle -->
    <!-- ============================================================== -->
{% endblock bread_crumb %}


{% block content %}
    <div class="container-fluid row">
        <div class="col-lg-3 pl-0 pr-0">
            <div class="col-md-12 pl-0 pr-0 mb-3">
                <div class="card pl-3 pr-3">
                    <div class="card-body">
                        <h4 class="card-title">Filter Reports</h4>
                        <h5 class="card-subtitle">Know range wise report</h5>
                        <div class="input-group mb-3">
                            <input type="date" name="from_date" class="form-control date-inputmask" placeholder="dd/mm/yyyy">
                            <input type="date" name="to_date" class="form-control" placeholder="dd/mm/yyyy">
                            <div class="input-group-append run-filter">
                                <span class="input-group-text"><i class="ti-arrow-right"></i></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-12 pl-0 pr-0 mb-3">
                <div class="card pl-3 pr-3">
                    <div class="card-body">
                        <h4 class="card-title">Activity Timings</h4>
                        <div class="row">
                            <div class="col-4 pl-1 pr-0 text-center">
                                <span class="display-6 text-primary">2376 </span>
                                <h5 style="font-size: 14px;">Required Working Hours</h5>
                            </div>
                            <div class="col-4 pl-1 pr-1 text-center">
                                <span class="display-6 text-primary">2376</span>
                                <h5 style="font-size: 14px;">Available/ESSL Hours</h5>
                            </div>
                            <div class="col-4 pl-1 pr-1 text-center">
                                <span class="display-6 text-primary">2376</span>
                                <h5 style="font-size: 14px;">Active/System Hours</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-12 pl-0 pr-0 mb-3">
                <div class="card bg-info">
                    <div class="card-body text-center">
                        
                        <h1 class="font-light text-white">2064</h1>
                        <h6 class="text-white">Target Mandays</h6>
                    </div>
                </div>
            </div>
            <div class="col-md-12 pl-0 pr-0 mb-3">
                <div class="card bg-success">
                    <div class="card-body text-center">
                        
                        <h1 class="font-light text-white">2064</h1>
                        <h6 class="text-white">Achieved Mandays</h6>
                    </div>
                </div>
            </div>
            <div class="col-md-12 pl-0 pr-0 mb-3">
                <div class="card bg-primary">
                    <div class="card-body text-center">
                        
                        <h1 class="font-light text-white">2064</h1>
                        <h6 class="text-white">Leaves</h6>
                    </div>
                </div>
            </div>
            <div class="col-md-12 pl-0 pr-0 mb-3">
                <div class="card bg-warning">
                    <div class="card-body text-center">
                        
                        <h1 class="font-light text-white">2064</h1>
                        <h6 class="text-white">Missing ETA's</h6>
                    </div>
                </div>
            </div>
        </div>
        <!-- Shots Table View -->
        <div class="col-lg-9" id="shots_list_view">
            <div class="card pl-3 pr-3">

                <table id="shots_table" class="table display no-wrap" style="width:100%">


                </table>

            </div>
        </div>
        <div class="col-md-3 col-2 card" id="filter_div"
             style="display: none;height:1000px;overflow-y: auto;margin: 0px;">
            <h6><i onclick="header_vis(this)" class="ti-angle-right"></i> Header Visibility</h6>
            <div class="card" id="header_filter"
                 style="display: none; height:200px; overflow-y: scroll; border-bottom: 1px solid #494848;border-radius: 0px">
                <div class="card-body">
                    <input type="text" class="form-control column_vis" id="search_header" onkeyup="search_column()"
                           placeholder="Search for...">
                    <!-- <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="client" data-column="0"
                               value="check" checked>
                        <label class="custom-control-label" for="client">CLIENT</label>
                    </div> -->
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="project" data-column="1"
                               value="check" checked>
                        <label class="custom-control-label" for="project">PROJECT</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="seq" data-column="2"
                               value="check" checked>
                        <label class="custom-control-label" for="seq">SEQUENCE</label>
                    </div>
                    <!-- <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="shot" data-column="3"
                               value="check" checked>
                        <label class="custom-control-label" for="shot">SHOT</label>
                    </div> -->
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="task_type" data-column="4"
                               value="check" checked>
                        <label class="custom-control-label" for="task_type">TASK TYPE</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="type" data-column="5"
                               value="check" checked>
                        <label class="custom-control-label" for="type">TYPE</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="complexity" data-column="6"
                               value="check" checked>
                        <label class="custom-control-label" for="complexity">COMPLEXITY</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="status" data-column="7"
                               value="check" checked>
                        <label class="custom-control-label" for="status">STATUS</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="progress" data-column="8"
                               value="check" checked>
                        <label class="custom-control-label" for="progress">PROGRESS</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="actual_bids" data-column="9"
                               value="check" checked>
                        <label class="custom-control-label" for="actual_bids">ACTUAL BIDS</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="consumed_bids"
                               data-column="10"
                               value="check" checked>
                        <label class="custom-control-label" for="consumed_bids">CONSUMED BIDS</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="eta" data-column="11"
                               value="check" checked>
                        <label class="custom-control-label" for="eta">ETA</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="frame_in" data-column="12"
                               value="check" checked>
                        <label class="custom-control-label" for="frame_in">FRAME IN</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="frame_out" data-column="13"
                               value="check" checked>
                        <label class="custom-control-label" for="frame_out">FRAME OUT</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="duration" data-column="14"
                               value="check" checked>
                        <label class="custom-control-label" for="duration">DURATION</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="team_lead" data-column="15"
                               value="check" checked>
                        <label class="custom-control-label" for="team_lead">TEAM LEAD</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="artist" data-column="16"
                               value="check" checked>
                        <label class="custom-control-label" for="artist">ARTIST</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="version" data-column="17"
                               value="check" checked>
                        <label class="custom-control-label" for="version">VERSION</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="location" data-column="18"
                               value="check" checked>
                        <label class="custom-control-label" for="location">LOCATION</label>
                    </div>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input toggle-vis" id="locality" data-column="19"
                               value="check" checked>
                        <label class="custom-control-label" for="locality">LOCALITY</label>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="form-group row">
                        <label for="min" class="col-4 col-form-label">ETA FROM</label>
                        <div class="col-8">
                            <input class="form-control" type="text" id="min" name="min">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="max" class="col-4 col-form-label">ETA TO</label>
                        <div class="col-8">
                            <input class="form-control" type="text" id="max" name="max">
                        </div>
                    </div>
                    <div class="dtsp-verticalContainer">
                        <div class="dtsp-verticalPanes">
                        </div>
                        <div class="container">
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <div id="select_lead_modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Select Team Lead</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal" role="form">
                        {% csrf_token %}
                        <div class="form-body" id="select_lead">
                            <select id="shot_lead_select" class="form-control">
                                <option value="0">Select Team Lead</option>
                                {% for lead in leads %}
                                    <option data-apikey={{ lead.apikey }} value={{ lead.id }}>{{ lead.fullName }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" name="save" class="btn btn-success waves-effect waves-light"
                            onclick="assign_lead()">Assign
                    </button>
                    <button type="button" name="close" class="btn btn-default waves-effect" data-dismiss="modal"
                            onclick="close_assign_modal()">Close
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal right fade" id="myModal2" role="dialog" aria-labelledby="myModalLabel2">
        <div class="modal-dialog" style="max-width: 40% !important; width: 40% !important;" role="document">
            <div class="modal-content">

                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel2"></h4>

                    <button type="button" id="modal_close" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <div class="card ">
                        <div style="border-radius: 10px" class="col-lg-14">
                            <div class="float-left" class="ass_art_butt">
                                <button type="button" class="assign_artist btn waves-effect waves-light float-right"
                                        title="ASSIGN ARTIST" style="color: white"><i
                                        class="mdi mdi-account-plus" style="color:orange;"></i>
                                    ASSIGN TO ARTIST
                                </button>
                            </div>
                            <div class="float-left">

                                <button class="shot_approve btn waves-effect waves-light float-right" title="APPROVE"
                                        style="color: white">
                                    <i class="mdi mdi-checkbox-marked-circle" style="color:green;padding-top: 5px"></i>
                                    APPROVE
                                </button>
                            </div>
                            <div class="float-left">
                                <button class="shot_reject btn waves-effect waves-light float-right" title="REJECT"
                                        style="color: white"><i
                                        class="mdi mdi-close-circle" style="color: red;"></i> REJECT
                                </button>
                            </div>
                            <div class="float-left">
                                <button class="shot_reject btn waves-effect waves-light float-right" title="PUBLISH"
                                        style="color: white"><i
                                        class="mdi mdi-arrow-up-bold-circle" style="color: #006fff"></i> PUBLISH
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body pb-0">
                            <ul class="nav nav-tabs customtab" role="tablist">
                                <li class="nav-item"><a class="nav-link active" id="shot_details_tab" data-toggle="tab"
                                                        href="#shot_details"
                                                        role="tab" aria-selected="false"><span class="hidden-sm-up"><i
                                        class="ti-home"></i></span> <span class="hidden-xs-down">DETAILS</span></a></li>
                                <li class="nav-item"><a class="nav-link" data-toggle="tab" id="shot_notes_tab"
                                                        href="#shot_notes" role="tab"
                                                        aria-selected="true" onclick="shot_notes_tab()"><span
                                        class="hidden-sm-up"><i
                                        class="ti-user"></i></span> <span class="hidden-xs-down">NOTES</span></a></li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane show" id="shot_details" role="tabpanel">
                                    <div class="p-3">
                                        <div class="row">
                                            <div class="float-left col-6">
                                                <small class="text-muted">CLIENT:</small>
                                                <h5 id="clientt"></h5>
                                            </div>
                                            <div class="float-right col-6">
                                                <small class="text-muted">PROJECT:</small>
                                                <h5 id="projectt"></h5>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="float-left col-6">
                                                <small class="text-muted">SEQUENCE:</small>
                                                <h5 id="sequencee"></h5>
                                            </div>
                                            <div class="float-right col-6">
                                                <small class="text-muted">TASK TYPE:</small>
                                                <h5 id="task_typee"></h5>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="float-left col-6">
                                                <small class="text-muted">TYPE:</small>
                                                <h5 id="typee"></h5>
                                            </div>
                                            <div class="float-right col-6">
                                                <small class="text-muted">STATUS:</small>
                                                <h5 id="statuss"></h5>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="float-left col-6">
                                                <small class="text-muted">CLIENT ETA: <i
                                                        class="mdi mdi-check-circle-outline"
                                                        style="color: #ec680b;"></i></small>
                                                <h5 id="etaa"></h5>
                                            </div>
                                            <div class="float-right col-6">
                                                <small class="text-muted">INTERNAL ETA:</small>
                                                <h5><input type="date" class="form-control" id="int_etaa"></h5>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="float-left col-6">
                                                <small class="text-muted"> CLIENT BIDS: <i
                                                        class="mdi mdi-check-circle-outline"
                                                        style="color: #ec680b;"></i></small>
                                                <h5 id="bidss"></h5>
                                            </div>
                                            <div class="float-right col-6">
                                                <small class="text-muted">INTERNAL BIDS: </small>
                                                <h5><input type="number" class="form-control" value="" id="int_bidss">
                                                </h5>
                                            </div>

                                        </div>
                                        <div class="row">
                                            <div class="float-left col-6">
                                                <small class="text-muted">VERSION:</small>
                                                <h5 id="versionn"></h5>
                                            </div>
                                            <div class="float-right col-6">
                                                <small class="text-muted">PROGRESS:</small>
                                                <h5 id="progresss"></h5>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="float-left col-6">
                                                <small class="text-muted">TEAM LEAD:</small>
                                                <h5 id="team_leadd"></h5>
                                            </div>
                                            <div class="float-right col-6">
                                                <small class="text-muted">ARTISTS:</small>
                                                <h5 id="artists"></h5>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="float-left col-6">
                                                <small class="text-muted">SCOPE OF WORK:</small>
                                                <h5 id="scope_wrk"></h5>
                                            </div>
                                            <div class="float-right col-6">
                                                <small class="text-muted">COMPLEXITY:</small>
                                                <h5 id="complexityy"></h5>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="float-left col-12">
                                                <button type="button" name="save"
                                                        class="btn btn-success waves-effect waves-light"
                                                        onclick="shot_update()">Update
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane show" id="shot_notes" role="tabpanel">

                                    <div class="col-lg-12">
                                        <div class="card">
                                            <div class="comment-widgets">
                                                <!-- Comment Row -->
                                                {#                                                <div class="d-flex flex-row comment-row">#}
                                                {#                                                    <div class="p-2"><span class="round"><img#}
                                                {#                                                            src="/media/profiles/photo/default.png" alt="user"#}
                                                {#                                                            width="50"></span></div>#}
                                                {#                                                    <div class="comment-text w-100">#}
                                                {#                                                        <h5>Srinivas Reni</h5>#}
                                                {#                                                        <p class="mb-1">Lorem Ipsum is simply dummy text of the printing#}
                                                {#                                                            and type setting industry. Lorem Ipsum has beenorem Ipsum is#}
                                                {#                                                            simply dummy text of the printing and type setting#}
                                                {#                                                            industry.</p>#}
                                                {#                                                        <div class="comment-footer">#}
                                                {#                                                            <span class="text-muted float-right">April 14, 2016</span>#}
                                                {#                                                            <span class="label label-light-info">Pending</span>#}
                                                {#                                                            <span class="action-icons">#}
                                                {#                                                    <a href="javascript:void(0)"><i class="ti-pencil-alt"></i></a>#}
                                                {#                                                    <a href="javascript:void(0)"><i class="ti-check"></i></a>#}
                                                {#                                                    <a href="javascript:void(0)"><i class="ti-heart"></i></a>#}
                                                {#                                                </span>#}
                                                {#                                                        </div>#}
                                                {#                                                    </div>#}
                                                {#                                                </div>#}
                                                {#                                                <!-- Comment Row -->#}
                                                {#                                                <div class="d-flex flex-row comment-row active">#}
                                                {#                                                    <div class="p-2"><span class="round"><img#}
                                                {#                                                            src="/media/profiles/photo/default.png" alt="user"#}
                                                {#                                                            width="50"></span></div>#}
                                                {#                                                    <div class="comment-text active w-100">#}
                                                {#                                                        <h5>Sunil Reddy</h5>#}
                                                {#                                                        <p class="mb-1">Lorem Ipsum is simply dummy text of the printing#}
                                                {#                                                            and type setting industry. Lorem Ipsum has beenorem Ipsum is#}
                                                {#                                                            simply dummy text of the printing and type setting#}
                                                {#                                                            industry..</p>#}
                                                {#                                                        <div class="comment-footer ">#}
                                                {#                                                            <span class="text-muted float-right">April 14, 2016</span>#}
                                                {#                                                            <span class="label label-light-success">Approved</span>#}
                                                {#                                                            <span class="action-icons active">#}
                                                {#                                                    <a href="javascript:void(0)"><i class="ti-pencil-alt"></i></a>#}
                                                {#                                                    <a href="javascript:void(0)"><i class="icon-close"></i></a>#}
                                                {#                                                    <a href="javascript:void(0)"><i#}
                                                {#                                                            class="ti-heart text-danger"></i></a>#}
                                                {#                                                </span>#}
                                                {#                                                        </div>#}
                                                {#                                                    </div>#}
                                                {#                                                </div>#}
                                                {#                                                <!-- Comment Row -->#}
                                                {#                                                <div class="d-flex flex-row comment-row">#}
                                                {#                                                    <div class="p-2"><span class="round"><img#}
                                                {#                                                            src="/media/profiles/photo/default.png" alt="user"#}
                                                {#                                                            width="50"></span></div>#}
                                                {#                                                    <div class="comment-text w-100">#}
                                                {#                                                        <h5>Narendar Reddy</h5>#}
                                                {#                                                        <p class="mb-1">Lorem Ipsum is simply dummy text of the printing#}
                                                {#                                                            and type setting industry. Lorem Ipsum has beenorem Ipsum is#}
                                                {#                                                            simply dummy text of the printing and type setting#}
                                                {#                                                            industry.</p>#}
                                                {#                                                        <div class="comment-footer">#}
                                                {#                                                            <span class="text-muted float-right">April 14, 2016</span>#}
                                                {#                                                            <span class="label label-light-danger">Rejected</span>#}
                                                {#                                                            <span class="action-icons">#}
                                                {#                                                    <a href="javascript:void(0)"><i class="ti-pencil-alt"></i></a>#}
                                                {#                                                    <a href="javascript:void(0)"><i class="ti-check"></i></a>#}
                                                {#                                                    <a href="javascript:void(0)"><i class="ti-heart"></i></a>#}
                                                {#                                                </span>#}
                                                {#                                                        </div>#}
                                                {#                                                    </div>#}
                                                {#                                                </div>#}
                                            </div>
                                            <div class="card-body border-top">
                                                <form class="row ofx-send-notfic" method="POST"
                                                      enctype="multipart/form-data">
                                                    <!-- <div class="hiden-feilds"></div> -->
                                                    <div class="col-10 mt-3">
                                                        <textarea placeholder="Type your message here"
                                                                  id="shot_notes_msg" name="message"
                                                                  class="form-control b-0"></textarea>
                                                    </div>
                                                    <ul class="col-2 mt-4 ofx-notbtns">
                                                        <li>
                                                            <div class="fils fas fa-paperclip btn btn-info">
                                                                <input type="file" id="inputGroupFile01"
                                                                       name="attachments" multiple/>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <button type="submit" class="btn btn-info"><i
                                                                    class="fas fa-paper-plane"></i></button>
                                                        </li>
                                                    </ul>
                                                </form>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- modal-content -->
        </div><!-- modal-dialog -->
    </div><!-- modal -->

{% endblock content %}

{% block page_scripts %}
    <!--OFX Core JavaScript -->
    <script src="/static/ofx/core.js"></script>
    <!-- End Core Javascript -->
    <script src="/static/template/assets/plugins/popper/popper.min.js"></script>

    <script src="/static/third_party/DataTables/DataTables-1.12.1/js/jquery.dataTables.min.js"></script>
    <script src="/static/third_party/DataTables/Responsive-2.3.0/js/dataTables.responsive.min.js"></script>
    <script src="/static/third_party/DataTables/Responsive-2.3.0/js/responsive.bootstrap5.min.js"></script>
    <script src="/static/third_party/DataTables/Buttons-2.2.3/js/dataTables.buttons.min.js"></script>
    <script src="/static/third_party/DataTables/Buttons-2.2.3/js/buttons.html5.min.js"></script>
    <script src="/static/third_party/DataTables/Bootstrap-5-5.1.3/js/bootstrap.bundle.min.js"></script>
    <script src="/static/third_party/DataTables/custom_js/datatables_searchPane.js"></script>
    <script src="/static/third_party/DataTables/Select-1.4.0/js/dataTables.select.min.js"></script>
    <script src="/static/template/assets/plugins/moment/moment.js"></script>
    <script src="/static/third_party/DataTables/DateTime-1.1.2/js/dataTables.dateTime.min.js"></script>

    <script src="/static/main/jquery-ui.min.js"></script>
    <script src="/static/main/jquery.ui-contextmenu.min.js"></script>
    <script src="/static/main/dataTables.colReorder.min.js"></script>
    <script src="/static/main/fnFilterClear.js"></script>
    <script src="/static/template/assets/plugins/sweetalert/sweetalert.min.js"></script>
    <script>
        // Custom filtering function which will search data in column tweleve between two values
        $.fn.dataTable.ext.search.push(
            function (settings, data, dataIndex) {
                var min = minDate.val();
                var max = maxDate.val();
                var date = new Date(data[12]);

                if (
                    (min === null && max === null) ||
                    (min === null && date <= max) ||
                    (min <= date && max === null) ||
                    (min <= date && date <= max)
                ) {
                    return true;
                }
                return false;
            }
        );

        $(".column_filter").click(function (e) {
            var x = document.getElementById("filter_div");
            if (x.style.display === "none") {
                $('.col-lg-9').addClass('col-lg-6').removeClass('col-lg-9')
                x.style.display = "block";
            } else {
                x.style.display = "none";
                $('.col-lg-6').addClass('col-lg-9').removeClass('col-lg-6')
            }
        });

        $(window).click(function (e) {
            $("#filters-modal").modal('hide');
        });

        function header_vis(x) {
            x.classList.toggle("ti-angle-down");
            var s = document.getElementById("header_filter");
            if (s.style.display === "none") {
                s.style.display = "block";
            } else {
                s.style.display = "none";
            }
        }

        function search_column() {
            var input = document.getElementById("search_header");
            var filter = input.value.toLowerCase();
            var nodes = document.getElementsByClassName('custom-checkbox');

            for (i = 0; i < nodes.length; i++) {
                if (nodes[i].innerText.toLowerCase().includes(filter)) {
                    nodes[i].style.display = "block";
                } else {
                    nodes[i].style.display = "none";
                }
            }
        }

        let client_id = 0;
        let project_id = 0;
        let status_id = 0
        let location_id = 0
        let locality_id = 0
        let task_type_id = 0

        //  Load Shots Information
        status_list = "YTA|ATL|YTS|STQ|WIP|IRT|QIP|CRT|IAP|LAP|LRT|HLD|OMT"

        var shotId_arr = [];
        var table = ""

        $(document).ready(function () {

            // Create date inputs
            minDate = new DateTime($('#min'), {
                format: 'MMMM Do YYYY'
            });
            maxDate = new DateTime($('#max'), {
                format: 'MMMM Do YYYY'
            });

            table = $('#shots_table').DataTable({
                columnDefs: [
                    {
                        searchPanes: {
                            show: true
                        },
                        targets: [0,1,4,5,6,7]
                        // targets: [0,1,4,5,6,7]
                    },
                    {className: "shot_view", "targets": [0]},
                    {className: "shot_class", "targets": [3]}
                ],
                searchPanes: {
                    initCollapsed: true,
                    cascadePanes: true,
                    layout: 'columns-1',
                    controls: false
                },
                dom: '<"dtsp-dataTable"frtip>',
                "searching": true,

                "ajax": {
                    "processing": false,
                    "url": "/api/production/mytask/artist/" +  {{user.id}} + "/",
                    "type": "GET",
                    "dataSrc": "",
                    "async": true //displays data after loading the page
                },

                columns: [
                    // {
                    //     data: "id",
                    //     render: function (data, type, row, meta) {
                    //         return (
                    //             '<input type="checkbox" name="shotCheckbox" class="shot_checkbox"  value="' +
                    //             row.shot.id +
                    //             '">'
                    //         );
                    //     },
                    // },
                    {name: "client", title: "CLIENT", data: 'shot.sequence.project.client.name'},
                    {name: "project", title: "PROJECT", data: 'shot.sequence.project.name'},
                    {name: "seq", title: "SEQUENCE", data: 'shot.sequence.name'},
                    {name: "shot", title: "SHOT CODE", data: 'shot.name'},
                    {name: "task_type", title: "TASK TYPE", data: 'shot.task_type'},
                    {name: "type", title: "TYPE", data: 'shot.type'},
                    {name: "complexity", title: "COMPLEXITY", data: 'shot.complexity'},
                    {
                        name: "status",
                        title: "STATUS", data: 'task_status',
                        render: function (data, type, row, meta) {
                            // function 
                            // var x = "{{user.employee.role}}".replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '').toLowerCase()+'_';
                            // console.log(x);


                            // <div class="btn-group show">
                            //                 <button type="button" class="btn btn-danger dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                            //                     Action
                            //                 </button>
                            //                 <div class="dropdown-menu show" x-placement="top-start" style="position: absolute; transform: translate3d(0px, -197px, 0px); top: 0px; left: 0px; will-change: transform;">
                            //                     <a class="dropdown-item bg-danger text-white" href="javascript:void(0)">Action</a>
                            //                     <a class="dropdown-item" href="javascript:void(0)">Another action</a>
                            //                     <a class="dropdown-item" href="javascript:void(0)">Something else here</a>
                            //                     <div class="dropdown-divider"></div>
                            //                     <a class="dropdown-item" href="javascript:void(0)">Separated link</a>
                            //                 </div>
                            //             </div>



                            

                            return ( ofx_shot_status_dropdown("{{user.employee.department}}","{{user.employee.role}}",data.code,data.color,{task_id:row.id,shot_id:row.shot.id}) );
                            // return ( ofx_shot_status_dropdown("{{user.employee.role}}",data.code)+
                            //     '<span class="badge" style="color:white;padding:3px 10px;font-size:1em; background-color:' + data.color + '">' + data.code + '</span>'
                            // );
                        },
                    },
                    {
                        name: "progress",
                        title: "PROGRESS", data: 'art_percentage',
                        render: function (data, type, row, meta) {
                            let lx = ['danger','warning','info','primary','success'], status = parseInt(data);
                            return (
                                `<div class="table-input-field" style="position: relative;">
                                    <input class="read-x-input shot_percentage form-control" data-data='`+JSON.stringify({task_id:row.id,shot_id:row.shot.id,assigned_bids:row.assigned_bids})+`' type="number" min="0" max="100" value="`+status+`" step="1" style="width: 94px;top: -11px;left: 0px;" data-default="`+status+`" >
                                    <div class="progress" style="height: 15px;">
                                        <div class="progress-bar bg-`+lx[(status<25 ? 0 : (status<50 ? 1 : (status<75 ? 2 : (status<100 ? 3 : 4))))]+`" style="width:` + data + `%; color: white;font-weight: bold" role="progressbar">` + data + `%</div>
                                    </div>
                                </div>`
                            )
                        }
                    },
                    {name: "actual_bids", title: "ACTUAL BIDS", data: 'assigned_bids'},
                    {
                        name: "eta",
                        title: "ETA", data: 'eta',
                        render: function (data, type, row, meta) {
                            return moment(data).format("YYYY-MM-DD");
                        }
                    },
                    {name: "frame_in", title: "START FRAME", data: 'shot.actual_start_frame'},
                    {name: "frame_out", title: "END FRAME", data: 'shot.actual_end_frame'},
                    {
                        name: "duration",
                        title: "DURATION", data: null,
                        render: function (data, type, row, meta) {
                                return (row.shot.actual_end_frame - row.shot.actual_start_frame)+1;
                            }    
                    },
                    {name: "team_lead", title: "TEAM LEAD", data: 'shot.team_lead'},
                    {name: "version", title: "VERSION", data: 'shot.version'},
                    {name: "location", title: "LOCATION", data: 'shot.location.name'},
                    {name: "locality", title: "LOCALITY", data: 'shot.sequence.project.client.locality'},
                ],
                select: true,
                order: [[1, 'asc']],
                scrollResize: true,
                scrollX: true,
                scrollCollapse: true,
                buttons: [],
                "paging": true,
                "pageLength": 25,
                "bSortClasses": false,
                stateSave: true,
                deferLoading: 10,

            });
            {#console.log(table.state())#}
            $("#shots_table ").dataTable().find("tbody").on('click', 'tr', function () {
                console.log(table.row(this.rowIndex).data());
            });
            table.searchPanes()

            // Refilter the table to apply ETA Filters
            $('#min, #max').on('change', function () {
                table.draw();
            });

            // Below code saves boolean type  in localstorage for header visibility
            var all_columns = table.settings().init().columns;
            var visible_columns = [];
            for (var i in all_columns) {
                if (table.column(all_columns[i].name + ':name').visible()) {
                    localStorage.setItem(all_columns[i].name, true)
                    $('#' + all_columns[i].name).prop('checked', true)
                    visible_columns.push(all_columns[i].name);
                } else {
                    localStorage.setItem(all_columns[i].name, false)
                    $('#' + all_columns[i].name).prop('checked', false)
                }
            }

            // Toggles header visibility
            $('input.toggle-vis').on('click', function (e) {
                {#e.preventDefault();#}

                // Get the column API object
                var column = table.column($(this).attr('data-column'));

                // Toggle the visibility
                column.visible(!column.visible());
            });
            $("div.dtsp-verticalPanes").append(table.searchPanes.container());
        });

        

        $(document).on('change','input.shot_percentage',function(e){
            let min = parseFloat($(this).attr('min')), max = parseFloat($(this).attr('max')), now = parseFloat($(this).val());
            let deft = parseFloat($(this).parent().find('.progress-bar').html().split("%")[0]);
            if(min>=now && now != 0){
                $(this).val(deft.toString());
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'Entered percentage should not be less than '+min,
                });
                }else if(max<now && now != 100){
                    $(this).val(deft.toString());
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'Entered percentage should not be greater than 100',
                    });
                    }else{
                        var myTag = $(this), data = JSON.parse($(this).attr('data-data'));
                        $.ajax({
                            url: '/api/production/taskdaylogs/?task_id='+data.task_id,
                            type: 'GET',
                            dataType: "json",
                            contentType: 'application/json; charset=utf-8',
                            // data: JSON.stringify(post_data),
                            success: function (response) {
                                let allowPercentage = 0, selctedDate = null, todayLog = null;
                                $.each(response,function(x,z){
                                    if(!moment(moment(z.updated_date).format('YYYY-MM-DD')).isSame(moment().format('YYYY-MM-DD'))){
                                        if(selctedDate===null || moment(moment(z.updated_date).format('DD MMMM YYYY'))>selctedDate ){
                                            selctedDate = moment(moment(z.updated_date).format('DD MMMM YYYY'));
                                            allowPercentage = z.percentage;
                                            }
                                        }else{
                                            todayLog = z.id;
                                            }
                                    });
                                if(parseFloat(allowPercentage)>=now){
                                    $(myTag).val(deft.toString());
                                    $(myTag).attr('min',allowPercentage);
                                    Swal.fire({
                                            icon: 'error',
                                            title: 'Oops...',
                                            text: 'Entered percentage should not be less than previous day percentage ('+allowPercentage+'%)',
                                        });
                                    }else{
                                        console.log(todayLog,Object.assign({
                                                percentage: now,
                                                day_percentage: now - allowPercentage,
                                                consumed_man_day: ((data.assigned_bids/100)*(now - allowPercentage)).toFixed(2),
                                                artist: {{user.id}},
                                                updated_by: {{user.id}}
                                                },(todayLog===null?{ task: data.task_id }:{ })))
                                        $.ajax({
                                            url: '/api/production/taskdaylogs/'+(todayLog!=null?'?log_id='+todayLog:''),
                                            type: (todayLog!=null?'PUT':'POST'),
                                            dataType: "json",
                                            contentType: 'application/json; charset=utf-8',
                                            data: JSON.stringify(Object.assign({
                                                percentage: now,
                                                day_percentage: now - allowPercentage,
                                                consumed_man_day: ((data.assigned_bids/100)*(now - allowPercentage)).toFixed(2),
                                                },(todayLog===null?{ 
                                                    artist: {{user.id}},
                                                    updated_by: {{user.id}},
                                                    task: data.task_id }:{ }))),
                                            success: function (response) {
                                                let bartag = $(myTag).parent().find('.progress-bar');
                                                $(bartag).setProgressColor({ status:parseInt(now), prefix:'bg-' });
                                                $(bartag).html(now+"%");
                                                $(bartag).css("width",now+"%");
                                                setTaskData(JSON.parse($(myTag).attr('data-data')),{
                                                    art_percentage: now
                                                    });
                                            },
                                            error: function (jqXHR, exception) {
                                                console.log(jqXHR.responseText)
                                            }
                                        });
                                        }
                            },
                            error: function (jqXHR, exception) {
                                console.log(jqXHR.responseText)
                            }
                        });
                    }
            });
        //TeamLead Assignments Modal Show
        $(".assign_leads").click(function (e) {
            shotId_arr.length = 0
            $("input:checkbox[class=shot_checkbox]:checked").each(function () {
                shotId_arr.push($(this).val());
            });

            if (shotId_arr.length > 0) {
                $('#select_lead_modal').modal('show');
            } else {
                alert("No Shots are Selected")
            }
        });


        $("#modal_close").click(function () {
            $('#myModal2').modal('toggle')
        })
        
        // TeamLead Assignments Post Data Function
        function assign_lead() {
            post_data = [];
            var notifyData = [];
            for (i = 0; i < shotId_arr.length; i++) {
                shotData = {
                    "shot": shotId_arr[i],
                    "lead": $('#shot_lead_select option:selected').val(),
                    "assigned_by": {{ user.employee.id }}
                };
                post_data.push(shotData)

                notifyData.push({
                    referenceId: shotId_arr[i],
                    reference_type: "SHOT",
                    to_users: [$('#shot_lead_select option:selected').val()],
                    message: "Assigned By: " + $('#shot_lead_select option:selected').innerText,
                });
            }

            $.ajax({
                url: '/api/production/shot/assignments/',
                type: 'POST',
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(post_data),
                success: function (response) {
                    /*$.each(notifyData,function(k,e){
                        shotId:shotId_arr[i],
                    reference_type:"SHOT",
                    to_users=[$('#shot_lead_select option:selected').attr("data-apikey")],
                    message:"Assigned By: "+$('#shot_lead_select option:selected').innerText

                        ofx_ws_set_task(e.shotId,e.reference_type,"",e.to_users,[],e.message,attachments=null,notification=true,ws_data={},savedata=null);
                    });*/

                },
                error: function (jqXHR, exception) {
                    console.log(jqXHR.responseText)
                }
            });
            ofx_notify_save(notifyData);

            //Send Notification
            $wsClient.sendMessage("", "", [$('#shot_lead_select option:selected').attr("data-apikey")], [], {
                title: "{{ user.employee.fullName }}",
                message: shotId_arr.length + " Shot's Assigned"
            }, null);
            table.ajax.reload(null, false)
            $('#select_lead_modal').modal('hide');
        }

        // TeamLead Assignments Modal Close
        function close_assign_modal() {
            $('#select_lead_modal').modal('hide');
        }

        var shot_id = 0;

        function addComment(parent, response) {
            $.each(response, function (x, e) {
                let files = '';
                $.each(e.attachments, function (z, xe) {
                    files = files + `<div class="col-6">
                            <a class="btn waves-effect waves-light btn-block btn-dark" href="#" onclick="window.location = '/attachments/notes/download/` + xe.id + `/';" title="` + xe.file_name + `">
                                <p class="fas ` + (typeof fas_file_icons[xe.file_type] != "undefined" ? fas_file_icons[xe.file_type] : fas_file_icons['default']) + `"></p>
                                <p>
                                    <span class="file-name">` + xe.file_name + `</span>
                                    <span class="file-info">
                                        <i>` + formatBytes(xe.file_size, 2) + `</i>
                                        ` + (false ? `<i>File: ` + xe.file_type + `</i>` : '') + `
                                    </span>
                                </p>
                            </a>
                        </div>`;
                });
                $(parent).append(`<div class="d-flex flex-row comment-row conent-abc">
                                    <div class="p-2"><span class="round">
                                        <img src="` + e.from_user.photo + `" alt="` + e.from_user.fullName + `" onerror="this.src='/media/profiles/photo/default.png'" width="50"></span>
                                    </div>
                                    <div class="comment-text w-100">
                                        <h5>
                                            <span>` + e.from_user.fullName + `</span>
                                            <span class="text-muted float-right">` + moment(e.creation_date).format("MMM Do YYYY, h:mm a") + `</span>
                                        </h5>
                                        <p class="mb-1">` + e.message + `</p>
                                        <div class="comment-footer row file-x">` + files + `
                                            ` + (false ? `<span class="text-muted float-right">` + moment(e.creation_date).format("MMM Do YYYY, h:mm a") + `</span>
                                            <span class="action-icons">
                                                <a href="#"><i class="ti-pencil-alt"></i></a>
                                            </span>` : '') + `
                                        </div>
                                    </div>
                                </div>`);
            });
            let hit = 0;
            $(parent).find('.comment-row').each(function (e) {
                hit = hit + $(this).outerHeight();
            });

            $(parent).animate({
                scrollTop: hit
            }, 200, function () {
                // if you need a callback function
            });
            // console.log($(parent).outerHeight());
            // $(parent).scrollTop($(parent).scrollHeight);
            // $(parent).scrollTop($(parent).outerHeight());
        }

        $('#shots_table').on('click', 'td.shot_view', function (e) {
            window.location = '/production/shots/view/?shot_id='+table.row(this).data().shot.id;
            });
        
        // TODO: Enable to view the shots data in modal
        // Table On Row Click
        $('#shots_table').on('click', 'td.shot_class', function () {

            $('#shot_details').addClass('active')
            $('#shot_details_tab').addClass('active')
            $('#shot_notes_tab').removeClass('active')
            $("#myModal2").modal('show');
            shot_id = table.row(this).data().shot.id
            $("#myModalLabel2").text(table.row(this).data().shot.name)
            $("#clientt").text(table.row(this).data().shot.sequence.project.client.name)
            $("#projectt").text(table.row(this).data().shot.sequence.project.name)
            $("#sequencee").text(table.row(this).data().shot.sequence.name)
            $("#task_typee").text(table.row(this).data().shot.task_type)
            $("#typee").text(table.row(this).data().shot.type)

            $("#bidss").text(table.row(this).data().shot.bid_days)
            $("#team_leadd").text(table.row(this).data().shot.team_lead)
            var now = new Date(table.row(this).data().shot.eta);
            var day = ("0" + now.getDate()).slice(-2);
            var month = ("0" + (now.getMonth() + 1)).slice(-2);
            var eta_date = (day) + "-" + (month) + "-" + now.getFullYear();
            $("#etaa").text(eta_date)
            var int_now = new Date(table.row(this).data().shot.internal_eta);
            var int_day = ("0" + int_now.getDate()).slice(-2);
            var int_month = ("0" + (int_now.getMonth() + 1)).slice(-2);
            var int_eta_date = int_now.getFullYear() + "-" + (int_month) + "-" + (int_day);
            $("#int_etaa").val(int_eta_date)
            $("#shot_notes_msg").attr('data-id', shot_id);
            $("#shot_notes_msg").attr('data-type', table.row(this).data().shot.task_type);
            $("#int_bidss").val(table.row(this).data().shot.internal_bid_days)
            $("#statuss").html(`<span class="badge" style="color:white;padding:3px 10px;font-size:1em; background-color:` + table.row(this).data().shot.status.color + `">` + table.row(this).data().shot.status.code + `</span>`)
            $("#complexityy").html(`<span class="badge" style="color:white;padding:3px 10px;font-size:1em; background-color:red"> ` + table.row(this).data().shot.complexity + `</span>`)
            $("#progresss").html(`<div class="progress" style="height: 15px;">
                        <div class="progress-bar" style="width:` + table.row(this).data().shot.progress + `%; color: white;font-weight: bold" role="progressbar">` + table.row(this).data().shot.progress + `%</div>
                    </div>`);
            $('#progresss .progress-bar').setProgressColor({ status:parseInt(table.row(this).data().shot.progress), prefix:'bg-' });
            let parent = $(".comment-widgets");
            $(parent).html('');
        })

        function shot_notes_tab() {
            $.ajax({
                // url: '/api/wsnotifications/notificationlogs/?reference_type=SHOT&referenceId='+shot_id,
                url: '/api/wsnotifications/notificationlogs/',
                type: 'GET',
                data: {
                    'reference_type': 'SHOT',
                    'referenceId': shot_id,
                },
                success: function (response) {
                    let parent = $(".comment-widgets");
                    $(parent).html('');
                    addComment(parent, response);
                }
            });
        }


        function shot_update() {
            data = {
                "internal_eta": $("#int_etaa").val(),
                "internal_bid_days": $("#int_bidss").val()
            }
            $.ajax({
                url: '/api/production/shots/' + shot_id + '/',
                type: 'PUT',
                data: data,
                success: function (response) {
                    //...
                }
            });
        }

        // Export Production sheet to Excel
        function export_to_excel() {
            window.location = "/production/export_prod_report/?client=" + client_id + "&project=" + project_id + "&statuss=" + status_id + "&locality=" + locality_id + "&location=" + location_id + "&task_type=" + task_type_id
        }

        // $wsClient.sendMessage(dataId='',fromGroup = ''/*if user leave it blank*/, toUsers = ['qcpe0euzf1arzrzihroexhbfmpaeoyvh'], toGroups = [], message = message, savedata = null)

        /*    <a href="javascript:void(0)"><i class="ti-pencil-alt"></i></a>
                                                    <a href="javascript:void(0)"><i class="ti-check"></i></a>
                                                    <a href="javascript:void(0)"><i class="ti-heart"></i></a>
                                                */
        /* $($(this).closest(".card").find(".comment-widgets")).append(`<div class="d-flex flex-row comment-row">
                                                    <div class="p-2"><span class="round"><img
                                                            src="/media/profiles/photo/default.png" alt="user"
                                                            width="50"></span></div>
                                                    <div class="comment-text w-100">
                                                        <h5>Srinivas Reni</h5>
                                                        <p class="mb-1">HI Narendar</p>
                                                        <div class="comment-footer">
                                                            <span class="text-muted float-right">April 14, 2016</span>
                                                            <span class="label label-light-info">Pending</span>
                                                            <span class="action-icons">
<a href="javascript:void(0)"><i class="ti-pencil-alt"></i></a>
                                                    <a href="javascript:void(0)"><i class="ti-check"></i></a>
                                                    <a href="javascript:void(0)"><i class="ti-heart"></i></a>

                                                </span>
                                                        </div>
                                                    </div>
                                                </div>`); */
    var defaultDays = 30; //Days 
    // var instelDate = moment().subtract(defaultDays,'d').format("YYYY-MM");
    // var instelDate = moment().format("YYYY-MM");
    var type = window.location.hash.substring(1);
    var getKeys = getGetParam({'from_date':moment().startOf('month').format('YYYY-MM-DD')+'T00:00:00.000000','to_date':moment().endOf('month').format("YYYY-MM-DD")+'T23:59:59.999999'});
    // var table_parent = $('.inbox-center > table > tbody');
    // $(table_parent).html('');
    $.each(getKeys,function(x,e){
        $('input[name="'+x+'"]').attr("value",moment(e).format('YYYY-MM-DD'));
        });
    console.log(getKeys);
    $(document).on('click', '.run-filter',function(e){
        var fil = [];
        $(this).parent().find('input').each(function(e){
            if($(this).val().length>0){
                if($(this).attr('name')==='from_date'){
                    fil.push($(this).attr('name')+'='+$(this).val()+'T00:00:00.000000');
                    }else if($(this).attr('name')==='to_date'){
                        fil.push($(this).attr('name')+'='+$(this).val()+'T23:59:59.999999');
                        }else{
                            fil.push($(this).attr('name')+'='+$(this).val());
                            }
                }
            });
        var lin = fil.join("&");
        let xv = window.location.hash.substring(1);
        if(xv.length>0){
            lin = lin+'#'+xv;
            }
        let url = '/production/my_task/'+(fil.length>0?'?':'')+lin;
        window.location = url;
        // console.log(url);
        });
    </script>
{% endblock page_scripts %}