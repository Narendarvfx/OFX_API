{% extends 'main/base.html' %}
{% load static %}
{% block bread_crumb %}

<link rel='stylesheet' href="{%static 'assets/css/style.css'%}" type="text/css"/>
<style>
    .form-control {
        color: #fffcfc !important;
    }

    .container-fluid {
        padding: 10px !important;
    }

    .row {
        margin: 0px !important;
    }

    /* An ugly trick to use a filter icon */
    .ui-icon-volume-off.ui-icon-filter {
        -ms-transform: rotate(270deg);
        -webkit-transform: rotate(270deg);
        transform: rotate(270deg);
    }

    .card {
        padding: 10px 1px;
        background: #272c33 !important;
        color: #bbbec1 !important;
        margin-bottom: 10px !important;
    }

    #filter_div {
        padding: 10px;
        background: #272c33 !important;
        color: white;
    }

    .col-lg-12 {
        padding: 0px !important;
    }

    .col-lg-10 {
        padding: 0px !important;
    }

    .card-body {
        padding: 0rem !important;
    }

    .dt-buttons .dt-button {
        border-radius: 4px;
        background: orange;
        color: #ffffff
    }

    table.dataTable tbody tr {
        background-color: #272c33 !important;
        font-size: small;
        font-weight: normal;
    }

    table.dataTable tr.odd {
        background-color: #343a40 !important;
    }

    table.dataTable td {
        border-bottom: 0.2px !important;
        border-color: grey !important;
    }

    table.dataTable thead {
        color: #f6f5f5;
        font-weight: normal;
        font-size: small;
    }

    #shots_table_length, #shots_table_info, #shots_table_filter {
        color: #a2a1a1 !important;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button {
        padding: 2px;
        background: white !important;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button.current {
        color: #fff5f5 !important;
        background-color: #e5711d !important;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
        background-color: rgb(183, 110, 5) !important;
    }

    .dataTables_wrapper .dataTables_paginate .ellipsis {
        color: white;
    }

    tfoot input {
        width: 100% !important;
        padding: 3px !important;
        box-sizing: border-box !important;
    }

    table.dataTable tfoot th, table.dataTable tfoot td {
        padding: 5px;
        border-top: 0px;
    }

    .page-titles {
        padding-bottom: 0px;
    }

    .dataTables_wrapper .dataTables_length select {
        color: #ccc8c8 !important;
        background-color: inherit;
    }

    .dataTables_wrapper .dataTables_filter input {
        color: #dad8d8 !important;
    }


    table.dataTable tbody tr.selected {
        background-color: #315eb1 !important;
        color: white !important;
    }

    label {
        margin-bottom: 0px !important;
    }

    .multiselect-container > li > a > label {
        padding: 4px 20px 3px 20px;
    }

    table.dataTable tbody th, table.dataTable tbody td {
        padding: 7px;
    }

    .column_vis {
        height: 20px;
    }

    /* width */
    ::-webkit-scrollbar {
        width: 10px;
    }

    /* Track */
    ::-webkit-scrollbar-track {
        background: #383f48;
        border-radius: 5px;
    }

    /* Handle */
    ::-webkit-scrollbar-thumb {
        background: #2965b9;
        border-radius: 5px;
    }

    /* Handle on hover */
    ::-webkit-scrollbar-thumb:hover {
        background: #555;
    }


    div.dtsp-verticalContainer {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: flex-start;
        align-content: flex-start;
        align-items: flex-start;
    }

    div.dtsp-verticalContainer div.dtsp-verticalPanes,
    div.dtsp-verticalContainer div.container {
        width: 20%;
        flex-grow: 0;
        flex-shrink: 0;
        flex-basis: 0;
    }

    div.dtsp-verticalContainer div.dtsp-verticalPanes {
        flex-grow: 1;
        flex-shrink: 0;
        flex-basis: 26%;
    }

    div.dtsp-verticalPanes {
        margin-right: 10px;
    }

    div.dtsp-title {
        margin-right: 0px !important;
        margin-top: 13px !important;
    }

    input.dtsp-search {
        min-width: 0px !important;
        padding-left: 0px !important;
        margin: 0px !important;
    }

    div.dtsp-verticalContainer div.dtsp-verticalPanes div.dtsp-searchPanes {
        flex-direction: column;
        flex-basis: 0px;
    }

    div.dtsp-verticalContainer div.dtsp-verticalPanes div.dtsp-searchPanes div.dtsp-searchPane {
        flex-basis: 0px;
    }

    div.dtsp-verticalContainer div.container {
        flex-grow: 1;
        flex-shrink: 0;
        flex-basis: 80%;
    }

    div.dtsp-panesContainer {
        border: 1px solid transparent;
        border-radius: 6px;
        padding: 5px;
    }

    select {
        -webkit-appearance: none;
    }

    div.dtsp-narrow {
        flex-direction: column !important;
        background-color: #343a40;
    }

    div.dtsp-panesContainer button.dtsp-clearAll, div.dtsp-panesContainer button.dtsp-collapseAll, div.dtsp-panesContainer button.dtsp-showAll {
        border: none;
        background-color: #343a40;
        padding: 3px;
        border-radius: 5px;
    }

    div.dtsp-panesContainer button.dtsp-disabledButton {
        cursor: default !important;
        background-color: #343a40;
        padding: 3px;
        border-radius: 10px;
        color: white;
    }

    div.dtsp-panesContainer div.dataTables_wrapper div.dataTables_scrollBody {
        background: #343a40 !important;
        border-bottom: none;
    }

    /* An ugly trick to use a filter icon */
    .ui-icon-volume-off.ui-icon-filter {
        -ms-transform: rotate(270deg);
        -webkit-transform: rotate(270deg);
        transform: rotate(270deg);
    }

    .modal.right .modal-dialog {
        position: fixed;
        margin: auto;
        width: 700px;
        height: 100%;
        -webkit-transform: translate3d(0%, 0, 0);
        -ms-transform: translate3d(0%, 0, 0);
        -o-transform: translate3d(0%, 0, 0);
        transform: translate3d(0%, 0, 0);
    }

    .modal.right .modal-content {
        height: 100%;
        overflow-y: auto;
    }

    .modal.right .modal-body {
        padding: 15px 15px 15px;
    }

    .modal.right.fade .modal-dialog {
        right: 0px;
        -webkit-transition: opacity 0.3s linear, right 0.3s ease-out;
        -moz-transition: opacity 0.3s linear, right 0.3s ease-out;
        -o-transition: opacity 0.3s linear, right 0.3s ease-out;
        transition: opacity 0.3s linear, right 0.3s ease-out;
    }

    .modal.right.fade.in .modal-dialog {
        right: 0;
    }

    /* ----- MODAL STYLE ----- */
    .modal-content {
        border-radius: 0;
        border: none;
    }

    .modal-header {
        border-bottom-color: #EEEEEE;
        background-color: #e5711d;
    }

    input.dtsp-search::placeholder {
        color: #a4a4a8 !important;
    }
</style>
<div class="row page-titles">
    <div class="col-md-6 mb-2 col-12 float-left">
        <h3 class="text-themecolor mb-0 mt-2">Shot Details</h3>
    </div>
    <div class="col-md-6 mb-2 col-12 float-right"></div>
</div>

<!-- ============================================================== -->
<!-- End Bread crumb and right sidebar toggle -->
<!-- ============================================================== -->
{% endblock bread_crumb %}


{% block content %}
<div class="row md-v-align">
    <div class="col-7 pl-0 pr-0">
        <div class="row">
            <div class="col-12">
                <div class="row">
                    <div class="col-3 pl-0 status-bar">
                        <div class="card card-body">
                            <div class="row pt-2 pb-2">
                                <div class="col pr-0">
                                    <div style="position: relative;top: 50%;transform: translateY(-50%);">
                                        <h1 class="font-light">0%</h1>
                                        <h6 class="text-muted">Shot Progress</h6>
                                    </div>
                                </div>
                                <div class="col text-right align-self-center">
                                    <!-- <div data-label="0%" class="css-bar css-bar-larg mb-0 css-bar-success css-bar-0"><i class="mdi mdi-check"></i></div> -->
                                    <div data-label="0%" class="css-bar mb-0 css-bar-0"
                                         style="transform: translateY(5%);"><i class="mdi mdi-check"></i></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-3 pl-0 task-bar">
                        <div class="card card-body">
                            <div class="row pt-2 pb-2">
                                <div class="col pr-0">
                                    <div style="position: relative;top: 50%;transform: translateY(-50%);">
                                        <h1 class="font-light">0%</h1>
                                        <h6 class="text-muted">Task Progress</h6>
                                    </div>
                                </div>
                                <div class="col text-right align-self-center">
                                    <!-- <div data-label="0%" class="css-bar css-bar-larg mb-0 css-bar-success css-bar-0"><i class="mdi mdi-check"></i></div> -->
                                    <div data-label="0%" class="css-bar mb-0 css-bar-0"
                                         style="transform: translateY(5%);"><i class="mdi mdi-check"></i></div>
                                </div>
                            </div>
                        </div>
                    </div>
<!--                    <div class="col-6 card card-body">-->
<!--                        <div class="text-center" style="position: relative;top: 50%;transform: translateY(-50%);">-->
<!--                            <a class="btn btn-secondary" href="#"><img src="/media/icons/nkX.png"-->
<!--                                                                       style="max-height: 40px;"/></a>-->
<!--                            <a class="btn btn-secondary" href="#"><img src="/media/icons/nk.png"-->
<!--                                                                       style="max-height: 40px;"/></a>-->
<!--                            <a class="btn btn-secondary" href="#"><img src="/media/icons/psd.png"-->
<!--                                                                       style="max-height: 40px;"/></a>-->
<!--                            <a class="btn btn-secondary" href="#"><img src="/media/icons/sfx.png"-->
<!--                                                                       style="max-height: 40px;"/></a>-->
<!--                            <a class="btn btn-secondary" href="#"><img src="/media/icons/maya.png"-->
<!--                                                                       style="max-height: 40px;"/></a>-->
<!--                            <a class="btn btn-secondary" href="#"><img src="/media/icons/mocha.png"-->
<!--                                                                       style="max-height: 40px;"/></a>-->
<!--                        </div>-->
<!--                    </div>-->
                </div>
            </div>
            <div class="col-12">
                <div class="card card-body shot-view-info">
                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs profile-tab" role="tablist">
                        <li class="nav-item"><a class="nav-link show active k-info" data-toggle="tab" href="#info"
                                                role="tab" aria-selected="true">Info</a></li>
                        <li class="nav-item"><a class="nav-link show k-members" data-toggle="tab" href="#members"
                                                role="tab" aria-selected="false">Members</a></li>
                        <li class="nav-item"><a class="nav-link show k-versions" data-toggle="tab" href="#versions"
                                                role="tab" aria-selected="false">Versions</a></li>
                        <li class="nav-item"><a class="nav-link show k-paths" data-toggle="tab" href="#paths" role="tab"
                                                aria-selected="false">Paths</a></li>
                        <li class="nav-item"><a class="nav-link show k-shot-logs" data-toggle="tab" href="#shotlogs"
                                                role="tab" aria-selected="false">Shot % Logs</a></li>
                        <li class="nav-item"><a class="nav-link show k-task-logs" data-toggle="tab" href="#tasklogs"
                                                role="tab" aria-selected="false">Task % Logs</a></li>
                        <li class="nav-item"><a class="nav-link show k-history-logs" data-toggle="tab"
                                                href="#historylogs" role="tab" aria-selected="false">History</a></li>
                        <li class="nav-item" id="shottabmanageshothelp2" style="display: none;"><a
                                class="nav-link show k-help-task" data-toggle="tab" href="#subShots" role="tab"
                                aria-selected="false">Sub Shots</a></li>
                        <!-- <li class="nav-item"><a class="nav-link show k-timeline" data-toggle="tab" href="#timeline" role="tab" aria-selected="false">Timeline</a></li>
                        <li class="nav-item"><a class="nav-link show k-statistics" data-toggle="tab" href="#statistics" role="tab" aria-selected="false">Statistics</a></li> -->
                    </ul>
                    <script>
                        if ((userPermissions.indexOf("can_manage_sub_shot") != -1)) {
                            document.getElementById("shottabmanageshothelp2").style.display = "block";
                        }
                    </script>
                    <!-- Tab panes -->
                    <div class="tab-content">
                        <!--second tab-->
                        <div class="tab-pane show active" id="info" role="tabpanel">
                            <div class="card-body side-bar-shot-details">
                                <div class="d-flex p-3 no-block" style="position: relative;">
                                    <h4 class="card-title mb-0 shot-name"></h4>
                                    <!-- <div class="ml-auto mb-2 mr-2">
                                        <div class="btn-group mr-2" role="group" aria-label="Button group with nested dropdown">
                                            <a href="#" class="btn btn-secondary mb-2 text-dark current-url"><i class="mdi mdi-reload font-18"></i></a>
                                            <a href="#" class="btn btn-secondary mb-2 text-dark"><i class="mdi mdi-account-plus font-18"></i></a>
                                        </div>
                                    </div> -->
                                </div>
                                <div class="row">
                                    <div class="col-6 pl-0 pr-0">
                                        <div class="table-responsive ">
                                            <table class="table no-wrap table-content-1 mb-0">
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="col-6 pl-0 pr-0"
                                         style="border-left: 1px solid rgba(0, 0, 0, 0.4) !important;">
                                        <div class="table-responsive ">
                                            <table class="table no-wrap table-content-2 mb-0">
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane show" id="members" role="tabpanel">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-12 pt-2">
                                        <div class="btn-group" role="group"
                                             aria-label="Button group with nested dropdown" style="float: right;">
                                            <a href="#" class="btn btn-warning mb-2 add-member"><i
                                                    class="mdi mdi-account-plus"></i> ADD ARTIST</a>
                                            <a href="#" class="btn btn-warning mb-2 save-members"><i
                                                    class="mdi mdi-floppy"></i> SAVE</a>
                                            <a href="#" target="_blank" class="btn btn-warning mb-2 tasks-export-tasks"><i
                                                    class="mdi mdi-cloud-download"></i> Export to EXCEL</a>
                                        </div>
                                    </div>
                                    <div class="col-12 pl-0 pr-0">
                                        <hr class="mb-1 mt-0">
                                        <div class="table-responsive ">
                                            <table class="table table-hover no-wrap members-content">
                                                <thead>
                                                <tr style="font-size: small;">
                                                    <th>ARTIST</th>
                                                    <th>TYPE</th>
                                                    <th>STATUS</th>
                                                    <th>BID DAYS</th>
                                                    <th>PROGRESS</th>
                                                    <th>CAPTAIN</th>
                                                    <th>ETA</th>
                                                    <th>ASSIGNED DATE</th>
                                                    <th>START DATE</th>
                                                    <th>COMPLETED DATE</th>
                                                    <th class="artst-task-delete">ACTION</th>
                                                </tr>
                                                </thead>
                                                <tbody class="main-set"></tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="col-12 pt-3" style="display: none;">
                                        <div class="row">
                                            <div class="col-md-6 col-lg-3 col-xlg-3"
                                                 style=" padding-left: 5px; padding-right: 5px;">
                                                <div class="card card-inverse card-info">
                                                    <div class="box bg-primary text-center"
                                                         style="border-radius: 15px;">
                                                        <h1 class="font-light text-white atr-tab-shot-bids">N/A</h1>
                                                        <h6 class="text-white">Shot biddays</h6>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-lg-3 col-xlg-3"
                                                 style=" padding-left: 5px; padding-right: 5px;">
                                                <div class="card card-inverse card-info">
                                                    <div class="box bg-info text-center" style="border-radius: 15px;">
                                                        <h1 class="font-light text-white atr-tab-assigned-biddays">
                                                            N/A</h1>
                                                        <h6 class="text-white">Assigned Biddays</h6>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-lg-3 col-xlg-3"
                                                 style=" padding-left: 5px; padding-right: 5px;">
                                                <div class="card card-inverse card-info">
                                                    <div class="box bg-success text-center"
                                                         style="border-radius: 15px;">
                                                        <h1 class="font-light text-white atr-tab-remaining-biddays">
                                                            N/A</h1>
                                                        <h6 class="text-white">Remaining Biddays</h6>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-lg-3 col-xlg-3"
                                                 style=" padding-left: 5px; padding-right: 5px;">
                                                <div class="card card-inverse card-info">
                                                    <div class="box bg-warning text-center"
                                                         style="border-radius: 15px;">
                                                        <h1 class="font-light text-white atr-tab-tasks">N/A</h1>
                                                        <h6 class="text-white">Total Task(s)</h6>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane show" id="versions" role="tabpanel">
                            <div class="card-body">
                                <div class="p-3">
                                    <ul class="nav nav-tabs customtab2" role="tablist">
                                        <li class="nav-item"><a class="nav-link show active" data-toggle="tab"
                                                                href="#leadversion" role="tab"
                                                                aria-selected="true"><span class="hidden-sm-up"><i
                                                class="ti-home"></i></span> <span
                                                class="hidden-xs-down">Lead Version</span></a></li>
                                        <li class="nav-item"><a class="nav-link show" data-toggle="tab"
                                                                href="#qcversion" role="tab" aria-selected="false"><span
                                                class="hidden-sm-up"><i class="ti-user"></i></span> <span
                                                class="hidden-xs-down">QC Version</span></a></li>
                                        <li class="nav-item"><a class="nav-link show" data-toggle="tab"
                                                                href="#clientversion" role="tab"
                                                                aria-selected="false"><span class="hidden-sm-up"><i
                                                class="ti-email"></i></span> <span
                                                class="hidden-xs-down">Client Version</span></a></li>
                                    </ul>
                                    <div class="tab-content tabcontent-border">
                                        <div class="tab-pane show active" id="leadversion" role="tabpanel">
                                            <div class="table-responsive ">
                                                <table class="table table-hover no-wrap versions-content-lead mb-0">
                                                    <thead>
                                                    <tr style="font-size: small;">
                                                        <th>VERSION</th>
                                                        <th>SENT BY</th>
                                                        <th>SENT DATE</th>
                                                        <th>STATUS</th>
                                                        <th>VERIFIED BY</th>
                                                        <th>VERIFIED DATE</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="tab-pane show" id="qcversion" role="tabpanel">
                                            <div class="table-responsive ">
                                                <table class="table table-hover no-wrap versions-content-qc mb-0">
                                                    <thead>
                                                    <tr style="font-size: small;">
                                                        <th>VERSION</th>
                                                        <th>SENT BY</th>
                                                        <th>SENT DATE</th>
                                                        <th>STATUS</th>
                                                        <th>VERIFIED BY</th>
                                                        <th>VERIFIED DATE</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="tab-pane show" id="clientversion" role="tabpanel">
                                            <div class="table-responsive ">
                                                <table class="table table-hover no-wrap versions-content-client mb-0">
                                                    <thead>
                                                    <tr style="font-size: small;">
                                                        <th>VERSION</th>
                                                        <th>SENT BY</th>
                                                        <th>SENT DATE</th>
                                                        <th>STATUS</th>
                                                        <th>VERIFIED BY</th>
                                                        <th>VERIFIED DATE</th>
                                                        <th>Output Path</th>
                                                        <th>Submission Note</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane show" id="paths" role="tabpanel">
                            <div class="card-body">
                                <div class="p-3">
                                    <div class="table-responsive ">
                                        <table class="table table-bordered no-wrap">
                                            <tbody>
                                            <tr style="font-size: small;">
                                                <th>Input Path:</th>
                                                <th class="input-path" style="width: 100%;"></th>
                                            </tr>
                                            <tr style="font-size: small;">
                                                <th>Retake Path:</th>
                                                <th class="retake-path" style="width: 100%;"></th>
                                            </tr>
                                            <tr style="font-size: small;">
                                                <th>Output Path:</th>
                                                <th class="output-path" style="width: 100%;"></th>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane show" id="shotlogs" role="tabpanel">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-12 pt-2">
                                        <div class="btn-group" role="group"
                                             aria-label="Button group with nested dropdown" style="float: right;">
                                            <a href="#" target="_blank" class="btn btn-warning mb-2 export-shot-logs"><i
                                                    class="mdi mdi-cloud-download"></i> Export to EXCEL</a>
                                        </div>
                                    </div>
                                    <div class="col-12 pl-0 pr-0">
                                        <div class="table-responsive ">
                                            <table class="table table-bordered no-wrap table-hover shotlogs-tab">
                                                <thead>
                                                <tr style="font-size: small;">
                                                    <th>DATE</th>
                                                    <th>CREATED BY</th>
                                                    <th>SHOT BID DAYS</th>
                                                    <th>CONSUMED MAN-DAY</th>
                                                    <th>SHOT PERCENTAGE</th>
                                                    <th>DAY PERCENTAGE</th>
                                                    <th>UPDATED BY</th>
                                                    <th>LAST UPDATE</th>
                                                </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane show" id="tasklogs" role="tabpanel">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-12 pt-2">
                                        <div class="btn-group" role="group"
                                             aria-label="Button group with nested dropdown" style="float: right;">
                                            <a href="#" target="_blank" class="btn btn-warning mb-2 export-task-logs"><i
                                                    class="mdi mdi-cloud-download"></i> Export to EXCEL</a>
                                        </div>
                                    </div>
                                    <div class="col-12 pl-0 pr-0">
                                        <div class="table-responsive ">
                                            <table class="table table-bordered no-wrap table-hover tasklogs-tab">
                                                <thead>
                                                <tr style="font-size: small;">
                                                    <th style="text-align: center;">DATE</th>
                                                    <th style="text-align: center;">CREATED BY</th>
                                                    <th style="text-align: center;">TASK BID DAYS</th>
                                                    <th style="text-align: center;">CONSUMED MAN-DAY</th>
                                                    <th style="text-align: center;">ARTIST PERCENTAGE</th>
                                                    <th style="text-align: center;">DAY PERCENTAGE</th>
                                                    <th style="text-align: center;">UPDATED BY</th>
                                                    <th style="text-align: center;">LAST UPDATE</th>
                                                </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane show" id="historylogs" role="tabpanel">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-12 pl-0 pr-0">
                                        <div class="historylogs-lab history-timeline">
                                            <div class="timeline">
                                                <div class="container">
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <div class="timeline-container">
                                                                <div class="timeline-end">
                                                                    <p>Now</p>
                                                                </div>
                                                                <div class="timeline-continue"></div>
                                                                <div class="timeline-start">
                                                                    <p>Start</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane show" id="subShots" role="tabpanel">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-12 pt-2">
                                        <div class="btn-group" role="group"
                                             aria-label="Button group with nested dropdown" style="float: right;">
                                            <select class="btn btn-warning mb-2 cerate-help-shot"></select>
                                            <a href="#" class="btn btn-warning mb-2 save-help-shot"><i
                                                    class="mdi mdi-floppy"></i> SAVE</a>
                                        </div>
                                    </div>
                                    <div class="col-12 pl-0 pr-0">
                                        <hr class="mb-1 mt-0">
                                        <div class="table-responsive ">
                                            <table class="table table-hover no-wrap subshot-content">
                                                <thead>
                                                <tr style="font-size: small;">
                                                    <th></th>
                                                    <th>TASK TYPE</th>
                                                    <th>TYPE</th>
                                                    <th>COMPLEXITY</th>
                                                    <th>CAPTAIN</th>
                                                    <th>STATUS</th>
                                                    <th>PROGRESS</th>
                                                    <th>HELP BIDS</th>
                                                    <th>PENDING BIDS</th>
                                                    <th>CONSUMED BIDS</th>
                                                    <th>ETA</th>
                                                    <th>SUPERVISOR</th>
                                                    <th>TEAM LEAD</th>
                                                    <th>HOD</th>
                                                    <th>ARTIST</th>
                                                    <th class="artst-task-delete">ACTION</th>
                                                </tr>
                                                </thead>
                                                <tbody class="main-set-shot sub-set-shot"></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- <div class="tab-pane show" id="timeline" role="tabpanel">
                            <div class="card-body">

                            </div>
                        </div>
                        <div class="tab-pane show" id="statistics" role="tabpanel">
                            <div class="card-body">

                            </div>
                        </div> -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-5">
        <div class="card" style="position: relative;height: 100%;margin: auto;height: calc(100vh - 176px);">
            <div class="card-body" style="height: 100%;height: calc(100% - 84px);position: relative;">
                <div class="d-flex pl-3 pr-3 pb-2 no-block" style="border-bottom: 1px solid rgba(0,0,0,.4);">
                    <h4 class="card-title mt-2 pt-1">Discussions</h4>
                </div>
                <div class="profiletimeline comment-widgets comment-widgets-larg"
                     style="height: 100%;height: calc(100% - 55px);overflow-y: auto;margin: auto;"></div>
            </div>
            <div class="card-body border-top">
                <form class="row ofx-send-notfic" method="POST" enctype="multipart/form-data">
                    <div class="col-10 mt-3">
                        <textarea placeholder="Type your message here" id="shot_notes_msg" name="message"
                                  class="form-control b-0"></textarea>
                    </div>
                    <ul class="col-2 mt-4 pr-3 ofx-notbtns">
                        <li>
                            <div class="fils fas fa-paperclip btn btn-info">
                                <input type="file" id="inputGroupFile01" name="attachments" multiple="">
                            </div>
                        </li>
                        <li>
                            <button type="submit" class="btn btn-info"><i class="fas fa-paper-plane"></i></button>
                        </li>
                    </ul>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- <div class="row">

    <div class="col-3">
        <div class="row">
            <div class="col-12 pl-0 pr-0 status-bar">
                <div class="card card-body">
                    <div class="row pt-2 pb-2">
                        <div class="col pr-0">
                            <div style="position: relative;top: 50%;transform: translateY(-50%);">
                                <h1 class="font-light">0%</h1>
                                <h6 class="text-muted">Shot Progress</h6>
                            </div>
                        </div>
                        <div class="col text-right align-self-center">
                            <div data-label="0%" class="css-bar css-bar-larg mb-0 css-bar-success css-bar-0"><i class="mdi mdi-check"></i></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
<div class="row">

    <div class="col-5">

    </div>
</div> -->

{% endblock content %}

{% block page_scripts %}
<!--OFX Core JavaScript -->
<script src="{% static 'ofx/core.js' %}"></script>
<!-- End Core Javascript -->


<script src="{% static 'main/jquery-ui.min.js' %}"></script>
<script src="{% static 'main/jquery.ui-contextmenu.min.js' %}"></script>

<script>
    $( document ).ready(function() {
        $('#ajaxBusy').hide();
    });
    function _setPagedata(e, task = {}) {
        $.ajax({
            url: '/api/v2/shot/task/',
            type: 'GET',
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            data: {shot__id: e.id},
            async: true, //displays data after loading the page
            processing: false,
            beforeSend: function (request) {
                request.setRequestHeader("required", JSON.stringify(["id", "assigned_bids"]));
            },
            success: function (all_shoshot_tasks) {
                e.minBidDays = 0;
                $.each(all_shoshot_tasks, function (x, tbid) {
                    e.minBidDays = e.minBidDays + parseFloat(tbid.assigned_bids);
                });
                if (userPermissions.indexOf("can_assign_to_artist") == -1 || noUpdateOnShot.indexOf(shotInfo.status.code) != -1) {
                    if (userPermissions.indexOf("can_assign_to_artist") == -1) {
                        $('.save-members').remove();
                        $('.add-member').remove();
                    } else {
                        $('.save-members').attr("style", "display:none;");
                        $('.add-member').attr("style", "display:none;");
                    }
                } else {
                    $('.save-members').attr("style", "");
                    $('.add-member').attr("style", "");
                }
                if (ofx_make_key(ofx_page_data.user.role) == ofx_make_key("VFX ARTIST")) {
                    $('.k-shot-logs, #shotlogs').remove();
                }
                $("#shot_notes_msg").attr('data-type', e.task_type);
                $(".shot-name").html(e.name);

                if (typeof task.id != "undefined") {
                    e.eta = task.eta;
                    e.internal_eta = task.eta;
                }
                if (typeof e.internal_eta != "undefined" && (e.internal_eta == null || e.internal_eta == "1970-01-01T00:00:00")) {
                    // e.internal_eta = e.eta;
                    e.internal_eta = null;
                }
                var dfts = [];

                dfts.push({
                    title: "CLIENT",
                    value: e.sequence.project.client.name,
                    feild: null,
                    attrb: {},
                });

                dfts.push({
                    title: "PROJECT",
                    value: e.sequence.project.name,
                    feild: null,
                    attrb: {},
                });

                dfts.push({
                    title: "SEQUENCE",
                    value: e.sequence.name,
                    feild: null,
                    attrb: {},
                });

                dfts.push({
                    title: "TASK TYPE",
                    value: e.task_type,
                    feild: null,
                    attrb: {},
                });
                dfts.push({
                    title: "TYPE",
                    value: e.type,
                    feild: null,
                    attrb: {},
                });
                /*
                if(typeof task.id != "undefined"){
                    dfts.push({
                        title:"TASK STATUS",
                        value: ofx_shot_status_dropdown(ofx_page_data.user.department,ofx_page_data.user.role,task.task_status.code,task.task_status.color,(task.compiler==2?{shot_id:e.id}:{task_id:task.id})),
                        feild: null,
                        attrb:{
                            class: `mytask-status-options `+(task.compiler==2?'compiler':'')
                            },
                        });
                    }else{
                        dfts.push({
                            title:"STATUS",
                            value: ((ofx_page_data.user.fullName!=null&&e.artist!=null&&ofx_make_key(ofx_page_data.user.fullName)==ofx_make_key(e.artist))||(ofx_page_data.user.role!=null&&ofx_make_key(ofx_page_data.user.role)!=ofx_make_key("VFX ARTIST")))?ofx_shot_status_dropdown(ofx_page_data.user.department,ofx_page_data.user.role,e.status.code,e.status.color,{shot_id:e.id}):`<button type="button" class="btn" title="`+e.status.name+`" style="cursor: default; color:white; padding: 3px 16px; font-size:1em; background-color:`+e.status.color+`;">`+e.status.code+`</button>`,
                            feild: null,
                            attrb:{},
                            });
                        }*/
                var isComp = (ofx_page_data.user.fullName != null && e.artist != null && ofx_make_key(ofx_page_data.user.fullName) == ofx_make_key(e.artist)),
                    isVFXArtist = (ofx_page_data.user.role != null && ofx_make_key(ofx_page_data.user.role) == ofx_make_key("VFX ARTIST")),
                    _trgt = '',
                    _dfBtn = (isVFXArtist && typeof task.id != "undefined") ? `<button type="button" class="btn" title="` + task.task_status.name + `" style="cursor: default; color:white; padding: 3px 16px; font-size:1em; background-color:` + task.task_status.color + `;">` + task.task_status.code + `</button>` : `<button type="button" class="btn" title="` + e.status.name + `" style="cursor: default; color:white; padding: 3px 16px; font-size:1em; background-color:` + e.status.color + `;">` + e.status.code + `</button>`;
                if ((userPermissions.indexOf("can_update_shot_status") != -1 || userPermissions.indexOf("can_update_task_status") != -1) && ((isVFXArtist && typeof task.id != "undefined") || !isVFXArtist)) {
                    _trgt = isVFXArtist ? ofx_shot_status_dropdown(ofx_page_data.user.department, ofx_page_data.user.role, task.task_status.code, task.task_status.color, (isComp ? {task_id: task.id} : {task_id: task.id})) : ofx_shot_status_dropdown(ofx_page_data.user.department, ofx_page_data.user.role, e.status.code, e.status.color, {shot_id: e.id});
                } else {
                    _trgt = _dfBtn;
                }
                dfts.push({
                    title: (isVFXArtist && typeof task.id != "undefined") ? "TASK STATUS" : "STATUS",
                    value: _trgt,
                    feild: null,
                    attrb: (isVFXArtist && typeof task.id != "undefined") ? {
                        class: `mytask-status-options ` + (isComp ? 'compiler' : '')
                    } : {},
                });
                if (allowAllActions || userPermissions.indexOf('can_view_client_eta') != -1 && typeof task.id == "undefined") {
                    dfts.push({
                        title: "CLIENT ETA",
                        value: `<span>` + moment(e.eta).format("MMM Do YYYY") + `</span>`,
                        feild: ((noUpdateOnShot.indexOf(e.status.code) == -1 && (allowAllActions || userPermissions.indexOf('can_update_shot_client_eta') != -1)) ? `<input class="read-shot-side-x" type="date" name="eta" value="` + e.eta.split('T')[0] + `" data-default="` + e.eta.split('T')[0] + `" >` : null),
                        attrb: ((noUpdateOnShot.indexOf(e.status.code) == -1 && (allowAllActions || userPermissions.indexOf('can_update_shot_client_eta') != -1)) ? {
                            class: 'table-input-field',
                            style: "position: relative; min-width: 180px;"
                        } : {}),
                    });
                }
                if (typeof task.id != "undefined") {
                    dfts.push({
                        title: "ASSIGNED BIDS",
                        value: `<span>` + task.assigned_bids + `</span>`,
                        feild: null,
                        attrb: {},
                    });
                } else if (allowAllActions || userPermissions.indexOf('can_view_client_bids') != -1) {
                    dfts.push({
                        title: "CLIENT BIDS",
                        value: `<span>` + e.bid_days + `</span>`,
                        feild: ((noUpdateOnShot.indexOf(e.status.code) == -1 && (allowAllActions || userPermissions.indexOf('can_update_shot_client_biddays') != -1)) ? `<input class="read-shot-side-x" type="number" name="bid_days" min="` + e.minBidDays.toFixed(2) + `" value="` + e.bid_days.toFixed(2) + `" step="0.10" style="max-width: 47px;" data-default="` + e.bid_days + `" >` : null),
                        attrb: ((noUpdateOnShot.indexOf(e.status.code) == -1 && (allowAllActions || userPermissions.indexOf('can_update_shot_client_biddays') != -1)) ? {
                            class: 'table-input-field',
                            style: "position: relative; min-width: 180px;"
                        } : {}),
                    });
                }
                if (typeof task.id != "undefined") {
                    dfts.push({
                        title: "TASK ETA",
                        value: `<span>` + moment(task.eta).format("MMM Do YYYY, h:mm a") + `</span>`,
                        feild: null,
                        attrb: {},
                    });
                } else {
                    dfts.push({
                        title: (allowAllActions || userPermissions.indexOf('can_view_client_eta') != -1 ? "INTERNAL " : "") + "ETA",
                        value: `<span>` + (e.internal_eta != null ? moment(e.internal_eta).format("MMM Do YYYY") : 'Pending') + `</span>`,
                        feild: ((noUpdateOnShot.indexOf(e.status.code) == -1 && (allowAllActions || userPermissions.indexOf('can_update_shot_internal_eta') != -1)) ? `<input class="read-shot-side-x" type="date" name="internal_eta" value="` + (e.internal_eta != null ? e.internal_eta : e.eta).split('T')[0] + `" data-default="` + (e.internal_eta != null ? e.internal_eta : e.eta).split('T')[0] + `" >` : null),
                        attrb: ((noUpdateOnShot.indexOf(e.status.code) == -1 && (allowAllActions || userPermissions.indexOf('can_update_shot_internal_eta') != -1)) ? {
                            class: 'table-input-field',
                            style: "position: relative; min-width: 180px;"
                        } : {}),
                    });
                }
                let lx = ['danger', 'warning', 'info', 'primary', 'success'];
                if (typeof task.id != "undefined") {
                    status = parseInt(task.art_percentage);
                    dfts.push({
                        title: "PROGRESS",
                        value: `<div class="progress" style="height: 15px;"><div class="progress-bar bg-` + lx[(status < 25 ? 0 : (status < 50 ? 1 : (status < 75 ? 2 : (status < 100 ? 3 : 4))))] + `" style="width:` + status + `%; color: white;font-weight: bold" role="progressbar">` + status + `%</div></div>`,
                        feild: null,
                        attrb: {},
                    });
                } else {
                    dfts.push({
                        title: "PROGRESS",
                        value: `<div class="progress" style="height: 15px;"><div class="progress-bar bg-` + lx[(e.progress < 25 ? 0 : (e.progress < 50 ? 1 : (e.progress < 75 ? 2 : (e.progress < 100 ? 3 : 4))))] + `" style="width:` + e.progress + `%; color: white;font-weight: bold" role="progressbar">` + e.progress + `%</div></div>`,
                        feild: ((noUpdateOnShot.indexOf(e.status.code) == -1 && (allowAllActions || userPermissions.indexOf('can_update_shot_percentage') != -1)) ? `<input class="read-shot-side-x cross-update on-change-re-update shot_percentage" data-cross=".status-bar" data-data='` + JSON.stringify({
                            shot_id: e.id,
                            bidDays: e.bid_days
                        }) + `' type="number"  min="0" data-min="` + (allowAllActions || userPermissions.indexOf('can_overwrite_shot_percentage') != -1 ? 0 : e.progress) + `" max="100" value="` + e.progress + `" step="1" style="width: 100%; top: 0px;left: 0px;" data-default="` + e.progress + `" >` : null),
                        attrb: ((noUpdateOnShot.indexOf(e.status.code) == -1 && (allowAllActions || userPermissions.indexOf('can_update_shot_percentage') != -1)) ? {
                            class: 'table-input-field',
                            style: 'position: relative;'
                        } : {}),
                    });
                }

                dfts.push({
                    title: "TEAM LEAD",
                    value: `<span>` + (e.team_lead != null ? e.team_lead : 'N/A') + `</span>`,
                    feild: null,
                    attrb: {},
                });
                dfts.push({
                    title: "SUPERVISOR",
                    value: `<span>` + (e.supervisor != null ? e.supervisor : 'N/A') + `</span>`,
                    feild: null,
                    attrb: {},
                });
                dfts.push({
                    title: "HOD",
                    value: `<span>` + (e.hod != null ? e.hod : 'N/A') + `</span>`,
                    feild: null,
                    attrb: {},
                });
                dfts.push({
                    title: "COMPILER",
                    value: `<span>` + (e.artist != null ? e.artist : 'N/A') + `</span>`,
                    feild: null,
                    attrb: {},
                });

                dfts.push({
                    title: "COMPLEXITY",
                    value: `<span class="badge" style="color:white;padding:3px 10px;font-size:1em; background-color:red"> ` + e.complexity + `</span>`,
                    feild: null,
                    attrb: {},
                });

                // artists = [];
                // $.each(e.artists,function(x,ex){
                //     if(e.artist!=ex.fullName){
                //         artists.push(ex.fullName);
                //         }
                //     });
                // dfts.push({
                //     title:"ARTISTS",
                //     value: `<span>`+(artists.length>0?artists.join(', '):'N/A')+`</span>`,
                //     feild: null,
                //     attrb:{},
                //     });

                var trx = ['', ''], isX1 = 0;
                $.each(dfts, function (zz, xx) {
                    let styleX = '';
                    xx.attrb.class = (typeof xx.attrb == "undefined" || typeof xx.attrb.class == "undefined") ? 'pt-1 pb-1' : (typeof xx.attrb.class != "undefined" ? xx.attrb.class + " " : "") + 'pt-1 pb-1';
                    $.each(xx.attrb, function (zz, ee) {
                        styleX = styleX + " " + zz + `='` + ee + `'`;
                    });
                    trx[isX1] = trx[isX1] + `<tr><td class="pt-1 pb-1" style="width: 10px;"><strong>` + xx.title + `</strong></td><td ` + styleX + `>` + (xx.feild != null ? xx.feild : '') + xx.value + `</td></tr>`;
                    isX1 = isX1 == 0 ? 1 : 0;
                });
                if (noUpdateOnShot.indexOf(e.status.code) == -1 && ((allowAllActions || userPermissions.indexOf('can_update_shot_client_eta') != -1 || userPermissions.indexOf('can_update_shot_client_biddays') != -1 || userPermissions.indexOf('can_update_shot_internal_eta') != -1 || userPermissions.indexOf('can_update_shot_percentage') != -1 || userPermissions.indexOf('can_update_shot_scope_of_work') != -1) && typeof task.id == "undefined" && $(".shot-name").parent().find('button.save-shot-details').length == 0)) {
                    $(".shot-name").parent().append(`<button type="button" class="save-shot-details v2 btn btn-success waves-effect waves-light" data-id="` + e.id + `" style="position: absolute; margin: auto; right: 0px; top: 0px; bottom: 0px; height: min-content; right: 10px;">Update</button>`);
                }
                $('.table-content-1 > tbody').html(trx[0]);
                $('.table-content-2 > tbody').html(trx[1]);
                if (typeof task.id != "undefined") {
                    status = parseInt(task.art_percentage);
                    $('.task-bar .css-bar').attr("data-label", status + '%');
                    $('.task-bar .css-bar').removeClass("css-bar-0");
                    $('.task-bar .css-bar').attr("class", "css-bar mb-0 css-bar-" + (parseInt(status / 5) * 5));
                    $('.task-bar .css-bar').setProgressColor({status: parseInt(status), prefix: 'css-bar-'});
                    if (!$('.task-bar .font-light').hasClass('table-input-field')) {
                        $('.task-bar .font-light').addClass('table-input-field');
                    }
                    $('.task-bar .font-light').html(`
                        ` + ((task.task_status.code != "YTS" && noUpdateOnShot.indexOf(e.status.code) == -1) ? `<input class="read-x-input shot_percentage on-change-re-update" data-data='` + JSON.stringify({
                        task_id: task.id,
                        assigned_bids: task.assigned_bids
                    }) + `' type="number" min="0" max="100" value="` + status + `" step="1" style="width: 100%;" data-default="` + status + `" >` : ``) + `
                        <span>` + status + `%</span>
                        <div class="progress" style="display:none;">
                            <div class="progress-bar bg-danger" style="width:` + status + `%; color: white;font-weight: bold" role="progressbar">` + status + `%</div>
                        </div>`);
                    if (task.compiler != 2) {
                        $('.task-bar').removeClass('col-3').addClass('col-6');
                    }
                } else {
                    $('.task-bar').remove();
                }
                if (noUpdateOnShot.indexOf(e.status.code) == -1 && (typeof task.id != "undefined" && task.task_status.code != "YTS" && task.compiler == 2 && userPermissions.indexOf('can_update_shot_percentage') != -1)) {
                    if (!$('.status-bar .font-light').hasClass('table-input-field')) {
                        $('.status-bar .font-light').addClass('table-input-field');
                    }
                    $('.status-bar .font-light').html(`
                        ` + (noUpdateOnShot.indexOf(e.status.code) == -1 ? `<input class="read-x-input shot_percentage on-change-re-update markmin" data-data='` + JSON.stringify({
                        shot_id: e.id,
                        bidDays: e.bid_days
                    }) + `' type="number" data-min="` + e.progress + `" min="0" max="100" value="` + e.progress + `" step="1" style="width: 100%;" data-default="` + e.progress + `" >` : ``) + `
                        <span>` + e.progress + `%</span>
                        <div class="progress" style="display:none;">
                            <div class="progress-bar bg-danger" style="width:` + e.progress + `%; color: white;font-weight: bold" role="progressbar">` + e.progress + `%</div>
                        </div>`);
                } else {
                    $('.status-bar .font-light').html(e.progress + '%');
                }
                $('.status-bar .css-bar').attr("data-label", e.progress + '%');
                $('.status-bar .css-bar').removeClass("css-bar-0");
                $('.status-bar .css-bar').attr("class", "css-bar mb-0 css-bar-" + (parseInt(e.progress / 5) * 5));
                $('.status-bar .css-bar').setProgressColor({status: parseInt(e.progress), prefix: 'css-bar-'});
                if (typeof task.id == "undefined") {
                    $('.status-bar').removeClass('col-3').addClass('col-6');
                } else if (task.compiler != 2) {
                    $('.status-bar').remove();
                }
                $('.input-path').html(e.input_path != null ? e.input_path : 'N/A');
                $('.retake-path').html(e.retake_path != null ? e.retake_path : 'N/A');
                $('.output-path').html((e.output_path != null && e.output_path.length > 0) ? e.output_path : 'N/A');
            },
            error: function (jqXHR, exception) {
                console.log(jqXHR.responseText)
            }
        });
    }

    function setPagedata(e) {
        if (ofx_make_key(ofx_page_data.user.role) == ofx_make_key("VFX ARTIST")) {
            $.ajax({
                url: '/api/v2/shot/task/',
                type: 'GET',
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                data: {shot__id: e.id, artist__id: ofx_page_data.user.id},
                async: true, //displays data after loading the page
                processing: false,
                beforeSend: function (request) {
                    request.setRequestHeader("required", JSON.stringify(["artist__id", "artist__fullName", "task_status__id", "task_status__code", "task_status__color", "assigned_bids", "compiler", "art_percentage", "creation_date", "start_date", "eta"]));
                },
                success: function (response) {
                    if (response.length > 0) {
                        _setPagedata(e, response[0]);
                    }
                },
                error: function (jqXHR, exception) {
                    console.log(jqXHR.responseText)
                }
            });
        } else {
            _setPagedata(e, {});
        }


    }

    function addComment2(parent, response) {
        // console.log(response);
        $.each(response, function (x, e) {
            let files = '';
            if (e.attachments.length > 0) {
                let row = {'images': '', 'files': ''};
                $.each(e.attachments, function (z, xe) {
                    if ($.inArray(xe.file_type, ['png', 'jpg', 'jpeg']) != -1) {
                        row['images'] = row['images'] + `<div class="col-md-4">
                                                                <a class="btn waves-effect waves-light btn-block btn-dark" href="/attachments/notes/download/` + xe.id + `" title="` + xe.file_name + `">
                                                                    <img class="img-thumbnail img-responsive" alt="attachment" src="` + xe.files + `" style="height: 110px;width: auto;max-width: 100%;max-height: initial;margin-top: 24px;">
                                                                    <p style="display: block;">
                                                                        <span class="file-name" style=" white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">` + xe.file_name + `</span>
                                                                        <span class="file-info">
                                                                            <i>` + formatBytes(xe.file_size, 2) + `</i>
                                                                        </span>
                                                                    </p>
                                                                </a>
                                                            </div>`;
                    } else {
                        row['files'] = row['files'] + `<div class="col-md-4">
                                                                <a class="btn waves-effect waves-light btn-block btn-dark" href="/attachments/notes/download/` + xe.id + `" title="` + xe.file_name + `">
                                                                    <p class="fas ` + (typeof fas_file_icons[xe.file_type] != "undefined" ? fas_file_icons[xe.file_type] : fas_file_icons['default']) + `" style="position: relative;margin: auto; font-size: 100px;padding-top: 24px;width: inherit;"></p>
                                                                    <p style="display: block;">
                                                                        <span class="file-name" style=" white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">` + xe.file_name + `</span>
                                                                        <span class="file-info">
                                                                            <i>` + formatBytes(xe.file_size, 2) + `</i>
                                                                        </span>
                                                                    </p>
                                                                </a>
                                                            </div>`;
                    }
                });
                files = ((row['images'].length > 0 || row['files'].length > 0) ? `<div class="row file-x">` + row['images'] + row['files'] + `</div>` : '');
            }
            if ($(parent).find('div').length > 0) {
                $(parent).append(`<hr>`);
            }
            // <a href="#" class="link">`+e.from_user.fullName+`</a>
            $(parent).append(`<div class="msg-items" style="padding: 8px 15px;">
                        <div style=" position: relative; display: block;">
                            <div class="btn btn-circle" style="padding:0px;display: inline-block;margin: auto;position: relative; margin-right: 10px;">
                                <img src="` + ((e.from_user != null && typeof e.from_user.photo != "undefined") ? e.from_user.photo : '/media/profiles/photo/default.png') + `" alt="` + ((e.from_user != null && typeof e.from_user.fullName != "undefined") ? e.from_user.fullName : 'Unknown User') + `" onerror="this.src='/media/profiles/photo/default.png'" width="50" style="width: 100%;border-radius: 50%">
                            </div>
                            <div style="display: inline-block;margin: auto;position: relative;width: calc(100% - 60px);">
                                <h4 class="mb-0">` + ((e.from_user != null && typeof e.from_user.fullName != "undefined") ? e.from_user.fullName : 'Unknown User') + `</h4>
                                <small class="text-right text-muted" style="-o-text-overflow: ellipsis; text-overflow: ellipsis; white-space: nowrap; display: inline-block; position: absolute; margin: auto; right: 0px; top: 0px;">` + moment(e.creation_date).format("MMM Do YYYY, h:mm a") + `</small>
                            </div>
                        </div>
                        <div style="padding: 8px 15px;border: 1px solid #7a7a7a;border-radius: 5px; margin-left: 55px;">
                            <p class="mb-0">` + e.message + `</p>
                            ` + (e.attachments.length > 0 ? `<h5><i class="fa fa-paperclip mr-2 mb-2"></i> Attachments <span>(` + e.attachments.length + `)</span></h5>` : '') + `
                            ` + files + `
                        </div>
                    </div>`);
        });
        let hit = 0;
        $(parent).find('.msg-items').each(function (e) {
            hit = hit + $(this).outerHeight() + 33;
        });

        $(parent).animate({
            scrollTop: hit
        }, 200, function () {
            // if you need a callback function
        });
    }

    var getKeys = getGetParam({'shot_id': null});
    var shotInfo = {};
    if (getKeys.shot_id === null) {
        window.location = '/production/shots/';
    } else {
        var shot_id = parseInt(getKeys.shot_id);
        $("#shot_notes_msg").attr('data-id', shot_id);
        $.ajax({
            url: '/api/production/shots/' + shot_id + '/',
            type: 'GET',
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            // data: getKeys,
            async: false,
            success: function (response) {
                if (typeof response.id != "undefined") {
                    shotInfo = response;
                    setPagedata(response);
                    $.ajax({
                        url: '/api/wsnotifications/notificationlogs/',
                        type: 'GET',
                        async: false,
                        data: {
                            'reference_type': 'SHOT',
                            'referenceId': shot_id,
                        },
                        success: function (response) {
                            let parent = $(".comment-widgets-larg");
                            $(parent).html('');
                            addComment2(parent, response);
                        }
                    });
                } else {
                    window.location = '/production/shots/';
                }
            },
            error: function (jqXHR, exception) {
                console.log(jqXHR.responseText)
            }
        });
    }
    var getKeys = getGetParam({'shot_id': null});
    // var shot_id = parseInt(getKeys.shot_id);
    var shot_id = getKeys.shot_id;

    $(document).on('click', 'a.k-info', function (e) {
        $.ajax({
            url: '/api/production/shots/' + shot_id + '/',
            type: 'GET',
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            async: false,
            // data: getKeys,
            success: function (response) {
                if (typeof response.id != "undefined") {
                    shotInfo = response;
                    setPagedata(response);
                } else {
                    window.location = '/production/shots/';
                }
            },
            error: function (jqXHR, exception) {
                console.log(jqXHR.responseText)
            }
        });
    });

    function setVersionTab(parent, data) {
        $.each(data, function (x, e) {
            $(parent).append(`<tr style="font-size: small;">
                        <td>
                            <span>` + e.version + `</span>
                        </td>
                        <td>
                            <span>` + e.sent_by + `</span>
                        </td>
                        <td>
                            <span>` + moment(e.sent_date).format("MMM Do YYYY, h:mm a") + `</span>
                        </td>
                        <td>
                            <span>` + e.status + `</span>
                        </td>
                        <td>
                            <span>` + ((e.verified_by != null) ? e.verified_by : 'N/A') + `</span>
                        </td>
                        <td>
                            <span>` + ((e.verified_date != null) ? moment(e.verified_date).format("MMM Do YYYY, h:mm a") : 'N/A') + `</span>
                        </td>
                        ` + (typeof e.output_path != "undefined" ? `<td>
                            <span>` + ((e.output_path != null && e.output_path.length > 0) ? e.output_path : 'N/A') + `</span>
                        </td>
                        <td>
                            <span>` + ((e.submission_notes != null && e.submission_notes.length > 0) ? e.submission_notes : 'N/A') + `</span>
                        </td>` : ``) + `
                    </tr>`);
        });
    }

    $(document).on('click', 'a.k-versions', function (e) {
        let target = [
            {url: '/api/production/allshotversions/' + shot_id + '/', 'parent': $('.versions-content-lead > tbody')},
            {url: '/api/production/allqcversions/' + shot_id + '/', 'parent': $('.versions-content-qc > tbody')},
            {
                url: '/api/production/all_client_versions/' + shot_id + '/',
                'parent': $('.versions-content-client > tbody')
            },
        ];
        $.each(target, function (x, ex) {
            $.ajax({
                url: ex.url,
                type: 'GET',
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                async: false,
                // data: getKeys,
                success: function (response) {
                    $(ex.parent).html('');
                    setVersionTab(ex.parent, response);
                },
                error: function (jqXHR, exception) {
                    console.log(jqXHR.responseText)
                }
            });
        });
    });
    // $(document).on('change','.on-change-re-update',function(e){
    //     setTimeout(function(){

    //         },2);

    //     });
    //role=='TEAM LEAD'||SUPERVISOR||QC?intenalETA:HOD|DATA I/O|PRODUCTION MANAGER|PIPELINE SUPPORT?external

    // <li class="nav-item"><a class="nav-link show active k-info" data-toggle="tab" href="#info" role="tab" aria-selected="true">Info</a></li> //
    //             <li class="nav-item"><a class="nav-link show k-members" data-toggle="tab" href="#members" role="tab" aria-selected="false">Members</a></li> //r'^api/production/mytask/shot/(?P<shotId>\d+)/$'
    //             <li class="nav-item"><a class="nav-link show k-versions" data-toggle="tab" href="#versions" role="tab" aria-selected="false">Versions</a></li> // I r'^api/production/allshotversions/(?P<verId>\d+)/$', Ex r'^api/production/allqcversions/(?P<verId>\d+)/$', Client r'^api/production/client_versions/(?P<shotId>\d+)/$'
    //             <li class="nav-item"><a class="nav-link show k-timeline" data-toggle="tab" href="#timeline" role="tab" aria-selected="false">Timeline</a></li> //
    //             <li class="nav-item"><a class="nav-link show k-paths" data-toggle="tab" href="#paths" role="tab" aria-selected="false">Paths</a></li> //
    //             <li class="nav-item"><a class="nav-link show k-statistics" data-toggle="tab" href="#statistics" role="tab" aria-selected="false">Statistics</a></li> //



</script>
{% endblock page_scripts %}